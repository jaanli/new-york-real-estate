/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/protomaps-leaflet@2.0.1/dist/protomaps-leaflet.module.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var t=Object.create,e=Object.defineProperty,i=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,n=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,a=Math.pow,o=(t,e)=>function(){return e||(0,t[r(t)[0]])((e={exports:{}}).exports,e),e.exports},l=(a,o,l)=>(l=null!=a?t(n(a)):{},((t,n,a,o)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let l of r(n))s.call(t,l)||l===a||e(t,l,{get:()=>n[l],enumerable:!(o=i(n,l))||o.enumerable});return t})(!o&&a&&a.__esModule?l:e(l,"default",{value:a,enumerable:!0}),a)),h=(t,e,i)=>new Promise(((r,n)=>{var s=t=>{try{o(i.next(t))}catch(t){n(t)}},a=t=>{try{o(i.throw(t))}catch(t){n(t)}},o=t=>t.done?r(t.value):Promise.resolve(t.value).then(s,a);o((i=i.apply(t,e)).next())})),c=o({"node_modules/@mapbox/point-geometry/index.js"(t,e){function i(t,e){this.x=t,this.y=e}e.exports=i,i.prototype={clone:function(){return new i(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=e*this.x-i*this.y,n=i*this.x+e*this.y;return this.x=r,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),n=e.x+i*(this.x-e.x)-r*(this.y-e.y),s=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=n,this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},i.convert=function(t){return t instanceof i?t:Array.isArray(t)?new i(t[0],t[1]):t}}}),f=o({"node_modules/@mapbox/unitbezier/index.js"(t,e){function i(t,e,i,r){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=i,this.p2y=r}e.exports=i,i.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},i.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},i.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},i.prototype.solveCurveX=function(t,e){var i,r,n,s,a;for(void 0===e&&(e=1e-6),n=t,a=0;a<8;a++){if(s=this.sampleCurveX(n)-t,Math.abs(s)<e)return n;var o=this.sampleCurveDerivativeX(n);if(Math.abs(o)<1e-6)break;n-=s/o}if((n=t)<(i=0))return i;if(n>(r=1))return r;for(;i<r;){if(s=this.sampleCurveX(n),Math.abs(s-t)<e)return n;t>s?i=n:r=n,n=.5*(r-i)+i}return n},i.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}}}),u=o({"node_modules/@mapbox/vector-tile/lib/vectortilefeature.js"(t,e){var i=c();function r(t,e,i,r,s){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=s,t.readFields(n,this,e)}function n(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){var i=t.readVarint()+t.pos;for(;t.pos<i;){var r=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[r]=n}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function s(t){for(var e,i,r=0,n=0,s=t.length,a=s-1;n<s;a=n++)e=t[n],r+=((i=t[a]).x-e.x)*(e.y+i.y);return r}e.exports=r,r.types=["Unknown","Point","LineString","Polygon"],r.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,n=1,s=0,a=0,o=0,l=[];t.pos<r;){if(s<=0){var h=t.readVarint();n=7&h,s=h>>3}if(s--,1===n||2===n)a+=t.readSVarint(),o+=t.readSVarint(),1===n&&(e&&l.push(e),e=[]),e.push(new i(a,o));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&l.push(e),l},r.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,n=0,s=0,a=1/0,o=-1/0,l=1/0,h=-1/0;t.pos<e;){if(r<=0){var c=t.readVarint();i=7&c,r=c>>3}if(r--,1===i||2===i)(n+=t.readSVarint())<a&&(a=n),n>o&&(o=n),(s+=t.readSVarint())<l&&(l=s),s>h&&(h=s);else if(7!==i)throw new Error("unknown command "+i)}return[a,l,o,h]},r.prototype.toGeoJSON=function(t,e,i){var n,a,o=this.extent*Math.pow(2,i),l=this.extent*t,h=this.extent*e,c=this.loadGeometry(),f=r.types[this.type];function u(t){for(var e=0;e<t.length;e++){var i=t[e],r=180-360*(i.y+h)/o;t[e]=[360*(i.x+l)/o-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var d=[];for(n=0;n<c.length;n++)d[n]=c[n][0];u(c=d);break;case 2:for(n=0;n<c.length;n++)u(c[n]);break;case 3:for(c=function(t){var e=t.length;if(e<=1)return[t];for(var i,r,n=[],a=0;a<e;a++){var o=s(t[a]);0!==o&&(void 0===r&&(r=o<0),r===o<0?(i&&n.push(i),i=[t[a]]):i.push(t[a]))}i&&n.push(i);return n}(c),n=0;n<c.length;n++)for(a=0;a<c[n].length;a++)u(c[n][a])}1===c.length?c=c[0]:f="Multi"+f;var p={type:"Feature",geometry:{type:f,coordinates:c},properties:this.properties};return"id"in this&&(p.id=this.id),p}}}),d=o({"node_modules/@mapbox/vector-tile/lib/vectortilelayer.js"(t,e){var i=u();function r(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(n,this,e),this.length=this._features.length}function n(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){var e=null,i=t.readVarint()+t.pos;for(;t.pos<i;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(i))}e.exports=r,r.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new i(this._pbf,e,this.extent,this._keys,this._values)}}}),p=o({"node_modules/@mapbox/vector-tile/lib/vectortile.js"(t,e){var i=d();function r(t,e,r){if(3===t){var n=new i(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}e.exports=function(t,e){this.layers=t.readFields(r,{},e)}}}),m=o({"node_modules/@mapbox/vector-tile/index.js"(t,e){e.exports.VectorTile=p(),e.exports.VectorTileFeature=u(),e.exports.VectorTileLayer=d()}}),g=o({"node_modules/ieee754/index.js"(t){t.read=function(t,e,i,r,n){var s,a,o=8*n-r-1,l=(1<<o)-1,h=l>>1,c=-7,f=i?n-1:0,u=i?-1:1,d=t[e+f];for(f+=u,s=d&(1<<-c)-1,d>>=-c,c+=o;c>0;s=256*s+t[e+f],f+=u,c-=8);for(a=s&(1<<-c)-1,s>>=-c,c+=r;c>0;a=256*a+t[e+f],f+=u,c-=8);if(0===s)s=1-h;else{if(s===l)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,r),s-=h}return(d?-1:1)*a*Math.pow(2,s-r)},t.write=function(t,e,i,r,n,s){var a,o,l,h=8*s-n-1,c=(1<<h)-1,f=c>>1,u=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+f>=1?u/l:u*Math.pow(2,1-f))*l>=2&&(a++,l/=2),a+f>=c?(o=0,a=c):a+f>=1?(o=(e*l-1)*Math.pow(2,n),a+=f):(o=e*Math.pow(2,f-1)*Math.pow(2,n),a=0));n>=8;t[i+d]=255&o,d+=p,o/=256,n-=8);for(a=a<<n|o,h+=n;h>0;t[i+d]=255&a,d+=p,a/=256,h-=8);t[i+d-p]|=128*m}}}),y=o({"node_modules/pbf/index.js"(t,e){e.exports=r;var i=g();function r(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var n=4294967296,s=1/n,a="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function o(t){return t.type===r.Bytes?t.readVarint()+t.pos:t.pos+1}function l(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function h(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=t;n--)i.buf[n+r]=i.buf[n]}function c(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function f(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function u(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function d(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function p(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function m(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function y(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function b(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function _(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function x(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function w(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function v(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}r.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,s=this.pos;this.type=7&r,t(n,e,this),this.pos===s&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=x(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=v(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=x(this.buf,this.pos)+x(this.buf,this.pos+4)*n;return this.pos+=8,t},readSFixed64:function(){var t=x(this.buf,this.pos)+v(this.buf,this.pos+4)*n;return this.pos+=8,t},readFloat:function(){var t=i.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=i.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(t,e,i){var r,n,s=i.buf;if(n=s[i.pos++],r=(112&n)>>4,n<128)return l(t,r,e);if(n=s[i.pos++],r|=(127&n)<<3,n<128)return l(t,r,e);if(n=s[i.pos++],r|=(127&n)<<10,n<128)return l(t,r,e);if(n=s[i.pos++],r|=(127&n)<<17,n<128)return l(t,r,e);if(n=s[i.pos++],r|=(127&n)<<24,n<128)return l(t,r,e);if(n=s[i.pos++],r|=(1&n)<<31,n<128)return l(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&a?function(t,e,i){return a.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){var r="",n=e;for(;n<i;){var s,a,o,l=t[n],h=null,c=l>239?4:l>223?3:l>191?2:1;if(n+c>i)break;1===c?l<128&&(h=l):2===c?128==(192&(s=t[n+1]))&&(h=(31&l)<<6|63&s)<=127&&(h=null):3===c?(s=t[n+1],a=t[n+2],128==(192&s)&&128==(192&a)&&((h=(15&l)<<12|(63&s)<<6|63&a)<=2047||h>=55296&&h<=57343)&&(h=null)):4===c&&(s=t[n+1],a=t[n+2],o=t[n+3],128==(192&s)&&128==(192&a)&&128==(192&o)&&((h=(15&l)<<18|(63&s)<<12|(63&a)<<6|63&o)<=65535||h>=1114112)&&(h=null)),null===h?(h=65533,c=1):h>65535&&(h-=65536,r+=String.fromCharCode(h>>>10&1023|55296),h=56320|1023&h),r+=String.fromCharCode(h),n+=c}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==r.Bytes)return t.push(this.readVarint(e));var i=o(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==r.Bytes)return t.push(this.readSVarint());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==r.Bytes)return t.push(this.readBoolean());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==r.Bytes)return t.push(this.readFloat());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==r.Bytes)return t.push(this.readDouble());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==r.Bytes)return t.push(this.readFixed32());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==r.Bytes)return t.push(this.readSFixed32());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==r.Bytes)return t.push(this.readFixed64());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==r.Bytes)return t.push(this.readSFixed64());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===r.Varint)for(;this.buf[this.pos++]>127;);else if(e===r.Bytes)this.pos=this.readVarint()+this.pos;else if(e===r.Fixed32)this.pos+=4;else{if(e!==r.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),w(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),w(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),w(this.buf,-1&t,this.pos),w(this.buf,Math.floor(t*s),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),w(this.buf,-1&t,this.pos),w(this.buf,Math.floor(t*s),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,r;t>=0?(i=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,r=r+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos]=127&t}(i,0,e),function(t,e){var i=(7&t)<<4;if(e.buf[e.pos++]|=i|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var r,n,s=0;s<e.length;s++){if((r=e.charCodeAt(s))>55295&&r<57344){if(!n){r>56319||s+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):n=r;continue}if(r<56320){t[i++]=239,t[i++]=191,t[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(t[i++]=239,t[i++]=191,t[i++]=189,n=null);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=63&r|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&h(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),i.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),i.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&h(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,r.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,c,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,f,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,p,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,u,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,d,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,m,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,y,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,b,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,_,e)},writeBytesField:function(t,e){this.writeTag(t,r.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,r.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,r.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,r.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}}}),b=o({"node_modules/rbush/rbush.min.js"(t,e){var i,r;i=t,r=function(){function t(t,r,n,s,a){!function t(i,r,n,s,a){for(;s>n;){if(s-n>600){var o=s-n+1,l=r-n+1,h=Math.log(o),c=.5*Math.exp(2*h/3),f=.5*Math.sqrt(h*c*(o-c)/o)*(l-o/2<0?-1:1);t(i,r,Math.max(n,Math.floor(r-l*c/o+f)),Math.min(s,Math.floor(r+(o-l)*c/o+f)),a)}var u=i[r],d=n,p=s;for(e(i,n,r),a(i[s],u)>0&&e(i,n,s);d<p;){for(e(i,d,p),d++,p--;a(i[d],u)<0;)d++;for(;a(i[p],u)>0;)p--}0===a(i[n],u)?e(i,n,p):e(i,++p,s),p<=r&&(n=p+1),r<=p&&(s=p-1)}}(t,r,n||0,s||t.length-1,a||i)}function e(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function i(t,e){return t<e?-1:t>e?1:0}var r=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function n(t,e,i){if(!i)return e.indexOf(t);for(var r=0;r<e.length;r++)if(i(t,e[r]))return r;return-1}function s(t,e){a(t,0,t.children.length,e,t)}function a(t,e,i,r,n){n||(n=p(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var s=e;s<i;s++){var a=t.children[s];o(n,t.leaf?r(a):a)}return n}function o(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function l(t,e){return t.minX-e.minX}function h(t,e){return t.minY-e.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function f(t){return t.maxX-t.minX+(t.maxY-t.minY)}function u(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function d(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function p(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(e,i,r,n,s){for(var a=[i,r];a.length;)if(!((r=a.pop())-(i=a.pop())<=n)){var o=i+Math.ceil((r-i)/n/2)*n;t(e,o,i,r,s),a.push(i,o,o,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(t){var e=this.data,i=[];if(!d(t,e))return i;for(var r=this.toBBox,n=[];e;){for(var s=0;s<e.children.length;s++){var a=e.children[s],o=e.leaf?r(a):a;d(t,o)&&(e.leaf?i.push(a):u(t,o)?this._all(a,i):n.push(a))}e=n.pop()}return i},r.prototype.collides=function(t){var e=this.data;if(!d(t,e))return!1;for(var i=[];e;){for(var r=0;r<e.children.length;r++){var n=e.children[r],s=e.leaf?this.toBBox(n):n;if(d(t,s)){if(e.leaf||u(t,s))return!0;i.push(n)}}e=i.pop()}return!1},r.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var r=this.data;this.data=i,i=r}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},r.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},r.prototype.clear=function(){return this.data=p([]),this},r.prototype.remove=function(t,e){if(!t)return this;for(var i,r,s,a=this.data,o=this.toBBox(t),l=[],h=[];a||l.length;){if(a||(a=l.pop(),r=l[l.length-1],i=h.pop(),s=!0),a.leaf){var c=n(t,a.children,e);if(-1!==c)return a.children.splice(c,1),l.push(a),this._condense(l),this}s||a.leaf||!u(a,o)?r?(i++,a=r.children[i],s=!1):a=null:(l.push(a),h.push(i),i=0,r=a,a=a.children[0])}return this},r.prototype.toBBox=function(t){return t},r.prototype.compareMinX=function(t,e){return t.minX-e.minX},r.prototype.compareMinY=function(t,e){return t.minY-e.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(t){return this.data=t,this},r.prototype._all=function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},r.prototype._build=function(t,e,i,r){var n,a=i-e+1,o=this._maxEntries;if(a<=o)return s(n=p(t.slice(e,i+1)),this.toBBox),n;r||(r=Math.ceil(Math.log(a)/Math.log(o)),o=Math.ceil(a/Math.pow(o,r-1))),(n=p([])).leaf=!1,n.height=r;var l=Math.ceil(a/o),h=l*Math.ceil(Math.sqrt(o));m(t,e,i,h,this.compareMinX);for(var c=e;c<=i;c+=h){var f=Math.min(c+h-1,i);m(t,c,f,l,this.compareMinY);for(var u=c;u<=f;u+=l){var d=Math.min(u+l-1,f);n.children.push(this._build(t,u,d,r-1))}}return s(n,this.toBBox),n},r.prototype._chooseSubtree=function(t,e,i,r){for(;r.push(e),!e.leaf&&r.length-1!==i;){for(var n=1/0,s=1/0,a=void 0,o=0;o<e.children.length;o++){var l=e.children[o],h=c(l),f=(u=t,d=l,(Math.max(d.maxX,u.maxX)-Math.min(d.minX,u.minX))*(Math.max(d.maxY,u.maxY)-Math.min(d.minY,u.minY))-h);f<s?(s=f,n=h<n?h:n,a=l):f===s&&h<n&&(n=h,a=l)}e=a||e.children[0]}var u,d;return e},r.prototype._insert=function(t,e,i){var r=i?t:this.toBBox(t),n=[],s=this._chooseSubtree(r,this.data,e,n);for(s.children.push(t),o(s,r);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(r,n,e)},r.prototype._split=function(t,e){var i=t[e],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);var a=this._chooseSplitIndex(i,n,r),o=p(i.children.splice(a,i.children.length-a));o.height=i.height,o.leaf=i.leaf,s(i,this.toBBox),s(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o)},r.prototype._splitRoot=function(t,e){this.data=p([t,e]),this.data.height=t.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(t,e,i){for(var r,n,s,o,l,h,f,u=1/0,d=1/0,p=e;p<=i-e;p++){var m=a(t,0,p,this.toBBox),g=a(t,p,i,this.toBBox),y=(n=m,s=g,o=Math.max(n.minX,s.minX),l=Math.max(n.minY,s.minY),h=Math.min(n.maxX,s.maxX),f=Math.min(n.maxY,s.maxY),Math.max(0,h-o)*Math.max(0,f-l)),b=c(m)+c(g);y<u?(u=y,r=p,d=b<d?b:d):y===u&&b<d&&(d=b,r=p)}return r||i-e},r.prototype._chooseSplitAxis=function(t,e,i){var r=t.leaf?this.compareMinX:l,n=t.leaf?this.compareMinY:h;this._allDistMargin(t,e,i,r)<this._allDistMargin(t,e,i,n)&&t.children.sort(r)},r.prototype._allDistMargin=function(t,e,i,r){t.children.sort(r);for(var n=this.toBBox,s=a(t,0,e,n),l=a(t,i-e,i,n),h=f(s)+f(l),c=e;c<i-e;c++){var u=t.children[c];o(s,t.leaf?n(u):u),h+=f(s)}for(var d=i-e-1;d>=e;d--){var p=t.children[d];o(l,t.leaf?n(p):p),h+=f(l)}return h},r.prototype._adjustParentBBoxes=function(t,e,i){for(var r=i;r>=0;r--)o(e[r],t)},r.prototype._condense=function(t){for(var e=t.length-1,i=void 0;e>=0;e--)0===t[e].children.length?e>0?(i=t[e-1].children).splice(i.indexOf(t[e]),1):this.clear():s(t[e],this.toBBox)},r},"object"==typeof t&&void 0!==e?e.exports=r():"function"==typeof define&&define.amd?define(r):(i=i||self).RBush=r()}}),_=l(c());function x(t,e,i){return Math.min(Math.max(t,i),e)}var w=class extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}};function v(t){if("string"!=typeof t)throw new w(t);if("transparent"===t.trim().toLowerCase())return[0,0,0,0];let e=t.trim();e=Y.test(t)?function(t){const e=t.toLowerCase().trim(),i=z[function(t){let e=5381,i=t.length;for(;i;)e=33*e^t.charCodeAt(--i);return(e>>>0)%2341}(e)];if(!i)throw new w(t);return`#${i}`}(t):t;const i=T.exec(e);if(i){const t=Array.from(i).slice(1);return[...t.slice(0,3).map((t=>parseInt(M(t,2),16))),parseInt(M(t[3]||"f",2),16)/255]}const r=j.exec(e);if(r){const t=Array.from(r).slice(1);return[...t.slice(0,3).map((t=>parseInt(t,16))),parseInt(t[3]||"ff",16)/255]}const n=S.exec(e);if(n){const t=Array.from(n).slice(1);return[...t.slice(0,3).map((t=>parseInt(t,10))),parseFloat(t[3]||"1")]}const s=X.exec(e);if(s){const[e,i,r,n]=Array.from(s).slice(1).map(parseFloat);if(x(0,100,i)!==i)throw new w(t);if(x(0,100,r)!==r)throw new w(t);return[...B(e,i,r),Number.isNaN(n)?1:n]}throw new w(t)}var k=t=>parseInt(t.replace(/_/g,""),36),z="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce(((t,e)=>{const i=k(e.substring(0,3)),r=k(e.substring(3)).toString(16);let n="";for(let t=0;t<6-r.length;t++)n+="0";return t[i]=`${n}${r}`,t}),{});var M=(t,e)=>Array.from(Array(e)).map((()=>t)).join(""),T=new RegExp(`^#${M("([a-f0-9])",3)}([a-f0-9])?$`,"i"),j=new RegExp(`^#${M("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),S=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${M(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),X=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,Y=/^[a-z]+$/i,F=t=>Math.round(255*t),B=(t,e,i)=>{let r=i/100;if(0===e)return[r,r,r].map(F);const n=(t%360+360)%360/60,s=(1-Math.abs(2*r-1))*(e/100),a=s*(1-Math.abs(n%2-1));let o=0,l=0,h=0;n>=0&&n<1?(o=s,l=a):n>=1&&n<2?(o=a,l=s):n>=2&&n<3?(l=s,h=a):n>=3&&n<4?(l=a,h=s):n>=4&&n<5?(o=a,h=s):n>=5&&n<6&&(o=s,h=a);const c=r-s/2;return[o+c,l+c,h+c].map(F)};function D(t,e,i){const r=(t,e)=>3===e?t:t/255,[n,s,a,o]=v(t).map(r),[l,h,c,f]=v(e).map(r),u=f-o,d=2*i-1,p=((d*u==-1?d:d+u/(1+d*u))+1)/2,m=1-p;return g=255*(s*m+h*p),y=255*(a*m+c*p),b=f*i+o*(1-i),`rgba(${x(0,255,255*(n*m+l*p)).toFixed()}, ${x(0,255,g).toFixed()}, ${x(0,255,y).toFixed()}, ${parseFloat(x(0,1,b).toFixed(3))})`;var g,y,b}var C=l(c()),P=l(f()),V=class{constructor(t,e){this.str=null!=t?t:e,this.perFeature="function"==typeof this.str&&2===this.str.length}get(t,e){return"function"==typeof this.str?this.str(t,e):this.str}},E=class{constructor(t,e=1){this.value=null!=t?t:e,this.perFeature="function"==typeof this.value&&2===this.value.length}get(t,e){return"function"==typeof this.value?this.value(t,e):this.value}},A=class{constructor(t){var e;this.labelProps=null!=(e=null==t?void 0:t.labelProps)?e:["name"],this.textTransform=null==t?void 0:t.textTransform}get(t,e){let i,r,n;r="function"==typeof this.labelProps?this.labelProps(t,e):this.labelProps;for(const t of r)if(Object.prototype.hasOwnProperty.call(e.props,t)&&"string"==typeof e.props[t]){i=e.props[t];break}if(n="function"==typeof this.textTransform?this.textTransform(t,e):this.textTransform,i&&"uppercase"===n)i=i.toUpperCase();else if(i&&"lowercase"===n)i=i.toLowerCase();else if(i&&"capitalize"===n){const t=i.toLowerCase().split(" ");i=t.map((t=>t[0].toUpperCase()+t.slice(1))).join(" ")}return i}},U=class{constructor(t){var e,i;(null==t?void 0:t.font)?this.font=t.font:(this.family=null!=(e=null==t?void 0:t.fontFamily)?e:"sans-serif",this.size=null!=(i=null==t?void 0:t.fontSize)?i:12,this.weight=null==t?void 0:t.fontWeight,this.style=null==t?void 0:t.fontStyle)}get(t,e){if(this.font)return"function"==typeof this.font?this.font(t,e):this.font;let i="";this.style&&(i="function"==typeof this.style?`${this.style(t,e)} `:`${this.style} `);let r,n,s="";return this.weight&&(s="function"==typeof this.weight?`${this.weight(t,e)} `:`${this.weight} `),r="function"==typeof this.size?this.size(t,e):this.size,n="function"==typeof this.family?this.family(t,e):this.family,`${i}${s}${r}px ${n}`}},R=l(c()),$=(t,e,i)=>{const r=[];let n,s,o,l=0,h=0,c=0,f=0,u=0,d=0,p=0,m=0,g=0,y=0,b=0,_=0;if(t.length<2)return[];if(2===t.length)return c=Math.sqrt(a(t[1].x-t[0].x,2)+a(t[1].y-t[0].y,2)),[{length:c,beginIndex:0,beginDistance:0,endIndex:2,endDistance:c}];for(f=Math.sqrt(a(t[1].x-t[0].x,2)+a(t[1].y-t[0].y,2)),l=1,h=t.length-1;l<h;l++)n=t[l-1],s=t[l],o=t[l+1],d=s.x-n.x,p=s.y-n.y,m=o.x-s.x,g=o.y-s.y,u=Math.sqrt(m*m+g*g),c+=f,y=Math.acos((d*m+p*g)/(f*u)),(y>e||c-_>i)&&(r.push({length:c-_,beginDistance:_,beginIndex:b,endIndex:l+1,endDistance:c}),b=l,_=c),f=u;return l-b>0&&r.push({length:c-_+u,beginIndex:b,beginDistance:_,endIndex:l+1,endDistance:c+u}),r};function I(t,e,i,r){const n=e.x-t.x,s=e.y-t.y,o=Math.sqrt(a(e.x-t.x,2)+a(e.y-t.y,2)),l=[];for(let e=0;e<i+r;e+=2*r){const i=1*e/o;l.push({x:t.x+i*n,y:t.y+i*s})}return l}function O(t,e){if(t.length<=e)return[t];const i=e-1,r=t.lastIndexOf(" ",i),n=t.indexOf(" ",i);if(-1===r&&-1===n)return[t];let s,a;return-1===n||r>=0&&i-r<n-i?(s=t.substring(0,r),a=t.substring(r+1,t.length)):(s=t.substring(0,n),a=t.substring(n+1,t.length)),[s,...O(a,e)]}var q=l(c()),W=l(m()),N=l(y()),Z=(t,e,i)=>new Promise(((r,n)=>{var s=t=>{try{o(i.next(t))}catch(t){n(t)}},a=t=>{try{o(i.throw(t))}catch(t){n(t)}},o=t=>t.done?r(t.value):Promise.resolve(t.value).then(s,a);o((i=i.apply(t,e)).next())})),K=Uint8Array,H=Uint16Array,J=Uint32Array,G=new K([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Q=new K([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),tt=new K([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),et=function(t,e){for(var i=new H(31),r=0;r<31;++r)i[r]=e+=1<<t[r-1];var n=new J(i[30]);for(r=1;r<30;++r)for(var s=i[r];s<i[r+1];++s)n[s]=s-i[r]<<5|r;return[i,n]},it=et(G,2),rt=it[0],nt=it[1];rt[28]=258,nt[258]=28;var st,at=et(Q,0)[0],ot=new H(32768);for(ct=0;ct<32768;++ct)st=(61680&(st=(52428&(st=(43690&ct)>>>1|(21845&ct)<<1))>>>2|(13107&st)<<2))>>>4|(3855&st)<<4,ot[ct]=((65280&st)>>>8|(255&st)<<8)>>>1;var lt=function(t,e,i){for(var r=t.length,n=0,s=new H(e);n<r;++n)t[n]&&++s[t[n]-1];var a,o=new H(e);for(n=0;n<e;++n)o[n]=o[n-1]+s[n-1]<<1;if(i){a=new H(1<<e);var l=15-e;for(n=0;n<r;++n)if(t[n])for(var h=n<<4|t[n],c=e-t[n],f=o[t[n]-1]++<<c,u=f|(1<<c)-1;f<=u;++f)a[ot[f]>>>l]=h}else for(a=new H(r),n=0;n<r;++n)t[n]&&(a[n]=ot[o[t[n]-1]++]>>>15-t[n]);return a},ht=new K(288);for(ct=0;ct<144;++ct)ht[ct]=8;for(ct=144;ct<256;++ct)ht[ct]=9;for(ct=256;ct<280;++ct)ht[ct]=7;for(ct=280;ct<288;++ct)ht[ct]=8;var ct,ft=new K(32);for(ct=0;ct<32;++ct)ft[ct]=5;var ut=lt(ht,9,1),dt=lt(ft,5,1),pt=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},mt=function(t,e,i){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(7&e)&i},gt=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},yt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],bt=function(t,e,i){var r=new Error(e||yt[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,bt),!i)throw r;return r},_t=function(t,e,i){var r=t.length;if(!r||i&&i.f&&!i.l)return e||new K(0);var n=!e||i,s=!i||i.i;i||(i={}),e||(e=new K(3*r));var a=function(t){var i=e.length;if(t>i){var r=new K(Math.max(2*i,t));r.set(e),e=r}},o=i.f||0,l=i.p||0,h=i.b||0,c=i.l,f=i.d,u=i.m,d=i.n,p=8*r;do{if(!c){o=mt(t,l,1);var m=mt(t,l+1,3);if(l+=3,!m){var g=t[(L=4+((l+7)/8|0))-4]|t[L-3]<<8,y=L+g;if(y>r){s&&bt(0);break}n&&a(h+g),e.set(t.subarray(L,y),h),i.b=h+=g,i.p=l=8*y,i.f=o;continue}if(1==m)c=ut,f=dt,u=9,d=5;else if(2==m){var b=mt(t,l,31)+257,_=mt(t,l+10,15)+4,x=b+mt(t,l+5,31)+1;l+=14;for(var w=new K(x),v=new K(19),k=0;k<_;++k)v[tt[k]]=mt(t,l+3*k,7);l+=3*_;var z=pt(v),M=(1<<z)-1,T=lt(v,z,1);for(k=0;k<x;){var L,j=T[mt(t,l,M)];if(l+=15&j,(L=j>>>4)<16)w[k++]=L;else{var S=0,X=0;for(16==L?(X=3+mt(t,l,3),l+=2,S=w[k-1]):17==L?(X=3+mt(t,l,7),l+=3):18==L&&(X=11+mt(t,l,127),l+=7);X--;)w[k++]=S}}var Y=w.subarray(0,b),F=w.subarray(b);u=pt(Y),d=pt(F),c=lt(Y,u,1),f=lt(F,d,1)}else bt(1);if(l>p){s&&bt(0);break}}n&&a(h+131072);for(var B=(1<<u)-1,D=(1<<d)-1,C=l;;C=l){var P=(S=c[gt(t,l)&B])>>>4;if((l+=15&S)>p){s&&bt(0);break}if(S||bt(2),P<256)e[h++]=P;else{if(256==P){C=l,c=null;break}var V=P-254;if(P>264){var E=G[k=P-257];V=mt(t,l,(1<<E)-1)+rt[k],l+=E}var A=f[gt(t,l)&D],U=A>>>4;A||bt(3),l+=15&A;F=at[U];if(U>3){E=Q[U];F+=gt(t,l)&(1<<E)-1,l+=E}if(l>p){s&&bt(0);break}n&&a(h+131072);for(var R=h+V;h<R;h+=4)e[h]=e[h-F],e[h+1]=e[h+1-F],e[h+2]=e[h+2-F],e[h+3]=e[h+3-F];h=R}}i.l=c,i.p=C,i.b=h,i.f=o,c&&(o=1,i.m=u,i.d=f,i.n=d)}while(!o);return h==e.length?e:function(t,e,i){(null==e||e<0)&&(e=0),(null==i||i>t.length)&&(i=t.length);var r=new(2==t.BYTES_PER_ELEMENT?H:4==t.BYTES_PER_ELEMENT?J:K)(i-e);return r.set(t.subarray(e,i)),r}(e,0,h)},xt=new K(0),wt=function(t){31==t[0]&&139==t[1]&&8==t[2]||bt(6,"invalid gzip data");var e=t[3],i=10;4&e&&(i+=t[10]|2+(t[11]<<8));for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!t[i++]);return i+(2&e)},vt=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},kt=function(t){(8!=(15&t[0])||t[0]>>>4>7||(t[0]<<8|t[1])%31)&&bt(6,"invalid zlib data"),32&t[1]&&bt(6,"invalid zlib data: preset dictionaries not supported")};function zt(t,e){return 31==t[0]&&139==t[1]&&8==t[2]?function(t,e){return _t(t.subarray(wt(t),-8),e||new K(vt(t)))}(t,e):8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31?function(t,e){return _t(t,e)}(t,e):function(t,e){return _t((kt(t),t.subarray(2,-4)),e)}(t,e)}var Mt="undefined"!=typeof TextDecoder&&new TextDecoder;try{Mt.decode(xt,{stream:!0}),1}catch(t){}var Tt=(t,e)=>t*Math.pow(2,e),Lt=(t,e)=>Math.floor(t/Math.pow(2,e)),jt=(t,e)=>Tt(t.getUint16(e+1,!0),8)+t.getUint8(e),St=(t,e)=>Tt(t.getUint32(e+2,!0),16)+t.getUint16(e,!0),Xt=(t,e,i,r,n)=>{if(t!=r.getUint8(n))return t-r.getUint8(n);const s=jt(r,n+1);if(e!=s)return e-s;const a=jt(r,n+4);return i!=a?i-a:0},Yt=(t,e,i,r)=>{const n=Ft(t,e,i,r);return n?{z:e,x:i,y:r,offset:n[0],length:n[1],is_dir:!1}:null},Ft=(t,e,i,r)=>{let n=0,s=t.byteLength/17-1;for(;n<=s;){const a=s+n>>1,o=Xt(e,i,r,t,17*a);if(o>0)n=a+1;else{if(!(o<0))return[St(t,17*a+7),t.getUint32(17*a+13,!0)];s=a-1}}return null},Bt=(t,e)=>t.is_dir&&!e.is_dir?1:!t.is_dir&&e.is_dir?-1:t.z!==e.z?t.z-e.z:t.x!==e.x?t.x-e.x:t.y-e.y,Dt=(t,e)=>{const i=t.getUint8(17*e);return{z:127&i,x:jt(t,17*e+1),y:jt(t,17*e+4),offset:St(t,17*e+7),length:t.getUint32(17*e+13,!0),is_dir:i>>7==1}},Ct=t=>{const e=[],i=new DataView(t);for(let t=0;t<i.byteLength/17;t++)e.push(Dt(i,t));return Pt(e)},Pt=t=>{t.sort(Bt);const e=new ArrayBuffer(17*t.length),i=new Uint8Array(e);for(let e=0;e<t.length;e++){const r=t[e];let n=r.z;r.is_dir&&(n|=128),i[17*e]=n,i[17*e+1]=255&r.x,i[17*e+2]=r.x>>8&255,i[17*e+3]=r.x>>16&255,i[17*e+4]=255&r.y,i[17*e+5]=r.y>>8&255,i[17*e+6]=r.y>>16&255,i[17*e+7]=255&r.offset,i[17*e+8]=255&Lt(r.offset,8),i[17*e+9]=255&Lt(r.offset,16),i[17*e+10]=255&Lt(r.offset,24),i[17*e+11]=255&Lt(r.offset,32),i[17*e+12]=255&Lt(r.offset,48),i[17*e+13]=255&r.length,i[17*e+14]=r.length>>8&255,i[17*e+15]=r.length>>16&255,i[17*e+16]=r.length>>24&255}return e};var Vt={getHeader:function(t){return Z(this,null,(function*(){const e=yield t.getBytes(0,512e3),i=new DataView(e.data),r=i.getUint32(4,!0),n=i.getUint16(8,!0),s=new TextDecoder("utf-8"),a=JSON.parse(s.decode(new DataView(e.data,10,r)));let o=0;"gzip"===a.compression&&(o=2);let l=0;"minzoom"in a&&(l=+a.minzoom);let h=0;"maxzoom"in a&&(h=+a.maxzoom);let c=0,f=0,u=0,d=-180,p=-85,m=180,g=85;if(a.bounds){const t=a.bounds.split(",");d=+t[0],p=+t[1],m=+t[2],g=+t[3]}if(a.center){const t=a.center.split(",");c=+t[0],f=+t[1],u=+t[2]}return{specVersion:i.getUint16(2,!0),rootDirectoryOffset:10+r,rootDirectoryLength:17*n,jsonMetadataOffset:10,jsonMetadataLength:r,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:o,tileType:1,minZoom:l,maxZoom:h,minLon:d,minLat:p,maxLon:m,maxLat:g,centerZoom:u,centerLon:c,centerLat:f,etag:e.etag}}))},getZxy:function(t,e,i,r,n,s,a){return Z(this,null,(function*(){let o=yield i.getArrayBuffer(e,t.rootDirectoryOffset,t.rootDirectoryLength,t);1===t.specVersion&&(o=Ct(o));const l=Yt(new DataView(o),r,n,s);if(l){let t=(yield e.getBytes(l.offset,l.length,a)).data;const i=new DataView(t);return 31==i.getUint8(0)&&139==i.getUint8(1)&&(t=zt(new Uint8Array(t))),{data:t}}const h=((t,e)=>{if(t.byteLength<17)return null;const i=t.byteLength/17,r=Dt(t,i-1);if(r.is_dir){const t=r.z,i=e.z-t;return{z:t,x:Math.trunc(e.x/(1<<i)),y:Math.trunc(e.y/(1<<i))}}return null})(new DataView(o),{z:r,x:n,y:s});if(h){const l=((t,e,i,r)=>{const n=Ft(t,128|e,i,r);return n?{z:e,x:i,y:r,offset:n[0],length:n[1],is_dir:!0}:null})(new DataView(o),h.z,h.x,h.y);if(l){let o=yield i.getArrayBuffer(e,l.offset,l.length,t);1===t.specVersion&&(o=Ct(o));const h=Yt(new DataView(o),r,n,s);if(h){let t=(yield e.getBytes(h.offset,h.length,a)).data;const i=new DataView(t);return 31==i.getUint8(0)&&139==i.getUint8(1)&&(t=zt(new Uint8Array(t))),{data:t}}}}}))}};function Et(t,e){return 4294967296*(e>>>0)+(t>>>0)}function At(t){const e=t.buf;let i,r;return r=e[t.pos++],i=127&r,r<128?i:(r=e[t.pos++],i|=(127&r)<<7,r<128?i:(r=e[t.pos++],i|=(127&r)<<14,r<128?i:(r=e[t.pos++],i|=(127&r)<<21,r<128?i:(r=e[t.pos],i|=(15&r)<<28,function(t,e){const i=e.buf;let r,n;if(n=i[e.pos++],r=(112&n)>>4,n<128)return Et(t,r);if(n=i[e.pos++],r|=(127&n)<<3,n<128)return Et(t,r);if(n=i[e.pos++],r|=(127&n)<<10,n<128)return Et(t,r);if(n=i[e.pos++],r|=(127&n)<<17,n<128)return Et(t,r);if(n=i[e.pos++],r|=(127&n)<<24,n<128)return Et(t,r);if(n=i[e.pos++],r|=(1&n)<<31,n<128)return Et(t,r);throw new Error("Expected varint not more than 10 bytes")}(i,t)))))}function Ut(t,e,i,r){if(0==r){1==i&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const r=e[0];e[0]=e[1],e[1]=r}}function Rt(t,e){return Z(this,null,(function*(){if(1===e||0===e)return t;if(2===e)return zt(new Uint8Array(t));throw Error("Compression method not supported")}))}function $t(t,e){let i=0,r=t.length-1;for(;i<=r;){const n=r+i>>1,s=e-t[n].tileId;if(s>0)i=n+1;else{if(!(s<0))return t[n];r=n-1}}if(r>=0){if(0===t[r].runLength)return t[r];if(e-t[r].tileId<t[r].runLength)return t[r]}return null}function It(t,e){const i=t.getUint32(e+4,!0),r=t.getUint32(e+0,!0);return i*Math.pow(2,32)+r}function Ot(t){const e={buf:new Uint8Array(t),pos:0},i=At(e),r=[];let n=0;for(let t=0;t<i;t++){const t=At(e);r.push({tileId:n+t,offset:0,length:0,runLength:1}),n+=t}for(let t=0;t<i;t++)r[t].runLength=At(e);for(let t=0;t<i;t++)r[t].length=At(e);for(let t=0;t<i;t++){const i=At(e);r[t].offset=0===i&&t>0?r[t-1].offset+r[t-1].length:i-1}return r}var qt=class extends Error{};function Wt(t,e,i,r){return Z(this,null,(function*(){const n=yield t.getBytes(0,16384);if(19792!==new DataView(n.data).getUint16(0,!0))throw new Error("Wrong magic number for PMTiles archive");if(function(t){const e=new DataView(t);return 2===e.getUint16(2,!0)?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):1===e.getUint16(2,!0)?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}(n.data)<3)return[yield Vt.getHeader(t)];const s=n.data.slice(0,127);let a=n.etag;r&&n.etag!=r&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+t.getKey()),a=void 0);const o=function(t,e){const i=new DataView(t),r=i.getUint8(7);if(r>3)throw Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:It(i,8),rootDirectoryLength:It(i,16),jsonMetadataOffset:It(i,24),jsonMetadataLength:It(i,32),leafDirectoryOffset:It(i,40),leafDirectoryLength:It(i,48),tileDataOffset:It(i,56),tileDataLength:It(i,64),numAddressedTiles:It(i,72),numTileEntries:It(i,80),numTileContents:It(i,88),clustered:1===i.getUint8(96),internalCompression:i.getUint8(97),tileCompression:i.getUint8(98),tileType:i.getUint8(99),minZoom:i.getUint8(100),maxZoom:i.getUint8(101),minLon:i.getInt32(102,!0)/1e7,minLat:i.getInt32(106,!0)/1e7,maxLon:i.getInt32(110,!0)/1e7,maxLat:i.getInt32(114,!0)/1e7,centerZoom:i.getUint8(118),centerLon:i.getInt32(119,!0)/1e7,centerLat:i.getInt32(123,!0)/1e7,etag:e}}(s,a);if(i){const i=n.data.slice(o.rootDirectoryOffset,o.rootDirectoryOffset+o.rootDirectoryLength),r=t.getKey()+"|"+(o.etag||"")+"|"+o.rootDirectoryOffset+"|"+o.rootDirectoryLength,s=Ot(yield e(i,o.internalCompression));return[o,[r,s.length,s]]}return[o,void 0]}))}var Nt=class{constructor(t,e,i){this.source="string"==typeof t?new class{constructor(t){this.url=t}getKey(){return this.url}getBytes(t,e,i){return Z(this,null,(function*(){let r;i||(r=new AbortController,i=r.signal);let n=yield fetch(this.url,{signal:i,headers:{Range:"bytes="+t+"-"+(t+e-1)}});if(416===n.status&&0===t){const t=n.headers.get("Content-Range");if(!t||!t.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const e=+t.substr(8);n=yield fetch(this.url,{signal:i,headers:{Range:"bytes=0-"+(e-1)}})}if(n.status>=300)throw Error("Bad response code: "+n.status);const s=n.headers.get("Content-Length");if(200===n.status&&(!s||+s>e))throw r&&r.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield n.arrayBuffer(),etag:n.headers.get("ETag")||void 0,cacheControl:n.headers.get("Cache-Control")||void 0,expires:n.headers.get("Expires")||void 0}}))}}(t):t,this.decompress=i||Rt,this.cache=e||new class{constructor(t=100,e=!0,i=Rt){this.cache=new Map,this.maxCacheEntries=t,this.counter=1,this.prefetch=e,this.decompress=i}getHeader(t,e){return Z(this,null,(function*(){const i=t.getKey();if(this.cache.has(i))return this.cache.get(i).lastUsed=this.counter++,yield this.cache.get(i).data;const r=new Promise(((i,r)=>{Wt(t,this.decompress,this.prefetch,e).then((t=>{t[1]&&this.cache.set(t[1][0],{lastUsed:this.counter++,data:Promise.resolve(t[1][2])}),i(t[0]),this.prune()})).catch((t=>{r(t)}))}));return this.cache.set(i,{lastUsed:this.counter++,data:r}),r}))}getDirectory(t,e,i,r){return Z(this,null,(function*(){const n=t.getKey()+"|"+(r.etag||"")+"|"+e+"|"+i;if(this.cache.has(n))return this.cache.get(n).lastUsed=this.counter++,yield this.cache.get(n).data;const s=new Promise(((n,s)=>{(function(t,e,i,r,n){return Z(this,null,(function*(){const s=yield t.getBytes(i,r);if(n.etag&&n.etag!==s.etag)throw new qt(s.etag);const a=Ot(yield e(s.data,n.internalCompression));if(0===a.length)throw new Error("Empty directory is invalid");return a}))})(t,this.decompress,e,i,r).then((t=>{n(t),this.prune()})).catch((t=>{s(t)}))}));return this.cache.set(n,{lastUsed:this.counter++,data:s}),s}))}getArrayBuffer(t,e,i,r){return Z(this,null,(function*(){const n=t.getKey()+"|"+(r.etag||"")+"|"+e+"|"+i;if(this.cache.has(n))return this.cache.get(n).lastUsed=this.counter++,yield this.cache.get(n).data;const s=new Promise(((s,a)=>{t.getBytes(e,i).then((t=>{if(r.etag&&r.etag!==t.etag)throw new qt(t.etag);s(t.data),this.cache.has(n),this.prune()})).catch((t=>{a(t)}))}));return this.cache.set(n,{lastUsed:this.counter++,data:s}),s}))}prune(){if(this.cache.size>=this.maxCacheEntries){let t,e=1/0;this.cache.forEach(((i,r)=>{i.lastUsed<e&&(e=i.lastUsed,t=r)})),t&&this.cache.delete(t)}}invalidate(t,e){return Z(this,null,(function*(){this.cache.delete(t.getKey()),yield this.getHeader(t,e)}))}}}getHeader(){return Z(this,null,(function*(){return yield this.cache.getHeader(this.source)}))}getZxyAttempt(t,e,i,r){return Z(this,null,(function*(){const n=function(t,e,i){if(t>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,t)-1||i>Math.pow(2,t)-1)throw Error("tile x/y outside zoom level bounds");let r=0,n=0;for(;n<t;)r+=Math.pow(2,n)*Math.pow(2,n),n++;let s=0,a=0,o=0;const l=[e,i];let h=Math.pow(2,t)/2;for(;h>0;)s=(l[0]&h)>0?1:0,a=(l[1]&h)>0?1:0,o+=h*h*(3*s^a),Ut(h,l,s,a),h/=2;return r+o}(t,e,i),s=yield this.cache.getHeader(this.source);if(s.specVersion<3)return Vt.getZxy(s,this.source,this.cache,t,e,i,r);if(t<s.minZoom||t>s.maxZoom)return;let a=s.rootDirectoryOffset,o=s.rootDirectoryLength;for(let t=0;t<=3;t++){const t=$t(yield this.cache.getDirectory(this.source,a,o,s),n);if(!t)return;if(t.runLength>0){const e=yield this.source.getBytes(s.tileDataOffset+t.offset,t.length,r);if(s.etag&&s.etag!==e.etag)throw new qt(e.etag);return{data:yield this.decompress(e.data,s.tileCompression),cacheControl:e.cacheControl,expires:e.expires}}a=s.leafDirectoryOffset+t.offset,o=t.length}throw Error("Maximum directory depth exceeded")}))}getZxy(t,e,i,r){return Z(this,null,(function*(){try{return yield this.getZxyAttempt(t,e,i,r)}catch(n){if(n instanceof qt)return this.cache.invalidate(this.source,n.message),yield this.getZxyAttempt(t,e,i,r);throw n}}))}getMetadataAttempt(){return Z(this,null,(function*(){const t=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(t.jsonMetadataOffset,t.jsonMetadataLength);if(t.etag&&t.etag!==e.etag)throw new qt(e.etag);const i=yield this.decompress(e.data,t.internalCompression),r=new TextDecoder("utf-8");return JSON.parse(r.decode(i))}))}getMetadata(){return Z(this,null,(function*(){try{return yield this.getMetadataAttempt()}catch(t){if(t instanceof qt)return this.cache.invalidate(this.source,t.message),yield this.getMetadataAttempt();throw t}}))}},Zt=(t=>(t[t.Point=1]="Point",t[t.Line=2]="Line",t[t.Polygon=3]="Polygon",t))(Zt||{});function Kt(t){return`${t.x}:${t.y}:${t.z}`}var Ht=(t,e,i)=>{t.pos=e;const r=t.readVarint()+t.pos;let n=1,s=0,a=0,o=0,l=1/0,h=-1/0,c=1/0,f=-1/0;const u=[];let d=[];for(;t.pos<r;){if(s<=0){const e=t.readVarint();n=7&e,s=e>>3}if(s--,1===n||2===n)a+=t.readSVarint()*i,o+=t.readSVarint()*i,a<l&&(l=a),a>h&&(h=a),o<c&&(c=o),o>f&&(f=o),1===n&&(d.length>0&&u.push(d),d=[]),d.push(new q.default(a,o));else{if(7!==n)throw new Error(`unknown command ${n}`);d&&d.push(d[0].clone())}}return d&&u.push(d),{geom:u,bbox:{minX:l,minY:c,maxX:h,maxY:f}}};function Jt(t,e){const i=new W.VectorTile(new N.default(t)),r=new Map;for(const[t,n]of Object.entries(i.layers)){const i=[],s=n;for(let t=0;t<s.length;t++){const r=Ht(s.feature(t)._pbf,s.feature(t)._geometry,e/s.extent);let n=0;for(const t of r.geom)n+=t.length;i.push({id:s.feature(t).id,geomType:s.feature(t).type,geom:r.geom,numVertices:n,bbox:r.bbox,props:s.feature(t).properties})}r.set(t,i)}return r}var Gt=class{constructor(t,e){this.p="string"==typeof t?new Nt(t):t,this.zoomaborts=[],this.shouldCancelZooms=e}get(t,e){return h(this,null,(function*(){this.shouldCancelZooms&&(this.zoomaborts=this.zoomaborts.filter((e=>e.z===t.z||(e.controller.abort(),!1))));const i=new AbortController;this.zoomaborts.push({z:t.z,controller:i});const r=i.signal,n=yield this.p.getZxy(t.z,t.x,t.y,r);return n?Jt(n.data,e):new Map}))}},Qt=class{constructor(t,e){this.url=t,this.zoomaborts=[],this.shouldCancelZooms=e}get(t,e){return h(this,null,(function*(){this.shouldCancelZooms&&(this.zoomaborts=this.zoomaborts.filter((e=>e.z===t.z||(e.controller.abort(),!1))));const i=this.url.replace("{z}",t.z.toString()).replace("{x}",t.x.toString()).replace("{y}",t.y.toString()),r=new AbortController;this.zoomaborts.push({z:t.z,controller:r});const n=r.signal;return new Promise(((t,r)=>{fetch(i,{signal:n}).then((t=>t.arrayBuffer())).then((i=>{const r=Jt(i,e);t(r)})).catch((t=>{r(t)}))}))}))}},te=class{constructor(t,e){this.source=t,this.cache=new Map,this.inflight=new Map,this.tileSize=e}get(t){return h(this,null,(function*(){const e=Kt(t);return new Promise(((i,r)=>{const n=this.cache.get(e);if(n)n.used=performance.now(),i(n.data);else{const n=this.inflight.get(e);n?n.push({resolve:i,reject:r}):(this.inflight.set(e,[]),this.source.get(t,this.tileSize).then((t=>{this.cache.set(e,{used:performance.now(),data:t});const r=this.inflight.get(e);if(r)for(const e of r)e.resolve(t);if(this.inflight.delete(e),i(t),this.cache.size>=64){let t,e=1/0;this.cache.forEach(((i,r)=>{i.used<e&&(e=i.used,t=r)})),t&&this.cache.delete(t)}})).catch((t=>{const i=this.inflight.get(e);if(i)for(const e of i)e.reject(t);this.inflight.delete(e),r(t)})))}}))}))}},ee=(t=>(t[t.Left=1]="Left",t[t.Center=2]="Center",t[t.Right=3]="Right",t))(ee||{}),ie=(t=>(t[t.N=1]="N",t[t.Ne=2]="Ne",t[t.E=3]="E",t[t.Se=4]="Se",t[t.S=5]="S",t[t.Sw=6]="Sw",t[t.W=7]="W",t[t.Nw=8]="Nw",t))(ie||{}),re=(t,e,i)=>{const r=document.createElement("canvas"),n=r.getContext("2d");return r.width=t,r.height=e,null!==n&&i(r,n),r},ne=class{constructor(t){var e;this.pattern=t.pattern,this.fill=new V(t.fill,"black"),this.opacity=new E(t.opacity,1),this.stroke=new V(t.stroke,"black"),this.width=new E(t.width,0),this.perFeature=null!=(e=this.fill.perFeature||this.opacity.perFeature||this.stroke.perFeature||this.width.perFeature||t.perFeature)&&e,this.doStroke=!1}before(t,e){if(!this.perFeature){t.globalAlpha=this.opacity.get(e),t.fillStyle=this.fill.get(e),t.strokeStyle=this.stroke.get(e);const i=this.width.get(e);i>0&&(this.doStroke=!0),t.lineWidth=i}if(this.pattern){const e=t.createPattern(this.pattern,"repeat");e&&(t.fillStyle=e)}}draw(t,e,i,r){let n=!1;if(this.perFeature){t.globalAlpha=this.opacity.get(i,r),t.fillStyle=this.fill.get(i,r);const e=this.width.get(i,r);e&&(n=!0,t.strokeStyle=this.stroke.get(i,r),t.lineWidth=e)}t.beginPath();for(const i of e)for(let e=0;e<i.length;e++){const r=i[e];0===e?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y)}(()=>{t.fill(),(n||this.doStroke)&&t.stroke()})()}};function se(t,e){return i=>{const r=i-t;return r>=0&&r<e.length?e[r]:0}}function ae(t,e){let i=0;for(;e[i+1][0]<t;)i++;return i}function oe(t,e,i){return t*(i-e)+e}function le(t,e,i,r){const n=r[e+1][0]-r[e][0],s=t-r[e][0];return 0===n?0:1===i?s/n:(a(i,s)-1)/(a(i,n)-1)}function he(t,e){return i=>{if(e.length<1)return 0;if(i<=e[0][0])return e[0][1];if(i>=e[e.length-1][0])return e[e.length-1][1];const r=ae(i,e);return oe(le(i,r,t,e),e[r][1],e[r+1][1])}}function ce(t,e){return i=>{if(e.length<1)return 0;let r=t;for(let t=0;t<e.length;t++)i>=e[t][0]&&(r=e[t][1]);return r}}function fe(t){return he(1,t)}function ue(t,e,i,r,n){return s=>{if(n.length<1)return 0;const a=new P.default(t,e,i,r),o=ae(s,n);return oe(a.solve(le(s,o,1,n)),n[o][1],n[o+1][1])}}var de=class{constructor(t){var e;this.color=new V(t.color,"black"),this.width=new E(t.width),this.opacity=new E(t.opacity),this.dash=t.dash?new class{constructor(t,e=[]){this.value=null!=t?t:e,this.perFeature="function"==typeof this.value&&2===this.value.length}get(t,e){return"function"==typeof this.value?this.value(t,e):this.value}}(t.dash):null,this.dashColor=new V(t.dashColor,"black"),this.dashWidth=new E(t.dashWidth,1),this.lineCap=new V(t.lineCap,"butt"),this.lineJoin=new V(t.lineJoin,"miter"),this.skip=!1,this.perFeature=!!((null==(e=this.dash)?void 0:e.perFeature)||this.color.perFeature||this.opacity.perFeature||this.width.perFeature||this.lineCap.perFeature||this.lineJoin.perFeature||t.perFeature)}before(t,e){this.perFeature||(t.strokeStyle=this.color.get(e),t.lineWidth=this.width.get(e),t.globalAlpha=this.opacity.get(e),t.lineCap=this.lineCap.get(e),t.lineJoin=this.lineJoin.get(e))}draw(t,e,i,r){if(this.skip)return;t.beginPath();for(const i of e)for(let e=0;e<i.length;e++){const r=i[e];0===e?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y)}(()=>{this.perFeature&&(t.globalAlpha=this.opacity.get(i,r),t.lineCap=this.lineCap.get(i,r),t.lineJoin=this.lineJoin.get(i,r)),this.dash?(t.save(),this.perFeature?(t.lineWidth=this.dashWidth.get(i,r),t.strokeStyle=this.dashColor.get(i,r),t.setLineDash(this.dash.get(i,r))):t.setLineDash(this.dash.get(i)),t.stroke(),t.restore()):(t.save(),this.perFeature&&(t.lineWidth=this.width.get(i,r),t.strokeStyle=this.color.get(i,r)),t.stroke(),t.restore())})()}},pe=class{constructor(t){this.name=t.name,this.sheet=t.sheet,this.dpr=window.devicePixelRatio}place(t,e,i){e[0];const r=new C.default(e[0][0].x,e[0][0].y),n=this.sheet.get(this.name),s=n.w/this.dpr,a=n.h/this.dpr;return[{anchor:r,bboxes:[{minX:r.x-s/2,minY:r.y-a/2,maxX:r.x+s/2,maxY:r.y+a/2}],draw:t=>{t.globalAlpha=1,t.drawImage(this.sheet.canvas,n.x,n.y,n.w,n.h,-n.w/2/this.dpr,-n.h/2/this.dpr,n.w/2,n.h/2)}}]}},me=class{constructor(t){this.radius=new E(t.radius,3),this.fill=new V(t.fill,"black"),this.stroke=new V(t.stroke,"white"),this.width=new E(t.width,0),this.opacity=new E(t.opacity)}draw(t,e,i,r){t.globalAlpha=this.opacity.get(i,r);const n=this.radius.get(i,r),s=this.width.get(i,r);s>0&&(t.strokeStyle=this.stroke.get(i,r),t.lineWidth=s,t.beginPath(),t.arc(e[0][0].x,e[0][0].y,n+s/2,0,2*Math.PI),t.stroke()),t.fillStyle=this.fill.get(i,r),t.beginPath(),t.arc(e[0][0].x,e[0][0].y,n,0,2*Math.PI),t.fill()}place(t,e,i){e[0];const r=new C.default(e[0][0].x,e[0][0].y),n=this.radius.get(t.zoom,i);return[{anchor:r,bboxes:[{minX:r.x-n,minY:r.y-n,maxX:r.x+n,maxY:r.y+n}],draw:e=>{this.draw(e,[[new C.default(0,0)]],t.zoom,i)}}]}},ge=class{constructor(t){this.font=new U(t),this.text=new A(t),this.fill=new V(t.fill,"black"),this.background=new V(t.background,"white"),this.padding=new E(t.padding,0)}place(t,e,i){const r=this.text.get(t.zoom,i);if(!r)return;const n=this.font.get(t.zoom,i);t.scratch.font=n;const s=t.scratch.measureText(r),a=s.width,o=s.actualBoundingBoxAscent,l=s.actualBoundingBoxDescent;e[0];const h=new C.default(e[0][0].x,e[0][0].y),c=this.padding.get(t.zoom,i);return[{anchor:h,bboxes:[{minX:h.x-a/2-c,minY:h.y-o-c,maxX:h.x+a/2+c,maxY:h.y+l+c}],draw:e=>{e.globalAlpha=1,e.fillStyle=this.background.get(t.zoom,i),e.fillRect(-a/2-c,-o-c,a+2*c,o+l+2*c),e.fillStyle=this.fill.get(t.zoom,i),e.font=n,e.fillText(r,-a/2,0)}}]}},ye=class{constructor(t){this.list=t}place(t,e,i){let r=this.list[0].place(t,e,i);if(!r)return;let n=r[0];const s=n.anchor;let a=n.bboxes[0];const o=a.maxY-a.minY,l=[{draw:n.draw,translate:{x:0,y:0}}],h=[[new C.default(e[0][0].x,e[0][0].y+o)]];for(let e=1;e<this.list.length;e++)r=this.list[e].place(t,h,i),r&&(n=r[0],a=be(a,n.bboxes[0]),l.push({draw:n.draw,translate:{x:0,y:o}}));return[{anchor:s,bboxes:[a],draw:t=>{for(const e of l)t.save(),t.translate(e.translate.x,e.translate.y),e.draw(t),t.restore()}}]}},be=(t,e)=>({minX:Math.min(t.minX,e.minX),minY:Math.min(t.minY,e.minY),maxX:Math.max(t.maxX,e.maxX),maxY:Math.max(t.maxY,e.maxY)}),_e=class{constructor(t){this.list=t}place(t,e,i){const r=this.list[0];if(!r)return;let n=r.place(t,e,i);if(!n)return;let s=n[0];const a=s.anchor;let o=s.bboxes[0];const l=[s.draw];for(let r=1;r<this.list.length;r++){if(n=this.list[r].place(t,e,i),!n)return;s=n[0],o=be(o,s.bboxes[0]),l.push(s.draw)}return[{anchor:a,bboxes:[o],draw:t=>{for(const e of l)e(t)}}]}},xe=class{constructor(t){this.symbolizer=t}place(t,e,i){const r=e[0][0],n=this.symbolizer.place(t,[[new C.default(0,0)]],i);if(!n||0===n.length)return;const s=n[0],a=s.bboxes[0],o=a.maxX-a.minX,l=a.maxY-a.minY;return[{anchor:r,bboxes:[{minX:r.x-o/2,maxX:r.x+o/2,minY:r.y-l/2,maxY:r.y+l/2}],draw:t=>{t.translate(-o/2,l/2-a.maxY),s.draw(t,{justify:2})}}]}},we=class{constructor(t,e){this.padding=new E(t,0),this.symbolizer=e}place(t,e,i){const r=this.symbolizer.place(t,e,i);if(!r||0===r.length)return;const n=this.padding.get(t.zoom,i);for(const t of r)for(const e of t.bboxes)e.minX-=n,e.minY-=n,e.maxX+=n,e.maxY+=n;return r}},ve=class{constructor(t){this.font=new U(t),this.text=new A(t),this.fill=new V(t.fill,"black"),this.stroke=new V(t.stroke,"black"),this.width=new E(t.width,0),this.lineHeight=new E(t.lineHeight,1),this.letterSpacing=new E(t.letterSpacing,0),this.maxLineCodeUnits=new E(t.maxLineChars,15),this.justify=t.justify}place(t,e,i){const r=this.text.get(t.zoom,i);if(!r)return;const n=this.font.get(t.zoom,i);t.scratch.font=n;const s=this.letterSpacing.get(t.zoom,i),a=O(r,this.maxLineCodeUnits.get(t.zoom,i));let o="",l=0;for(const t of a)t.length>l&&(l=t.length,o=t);const h=t.scratch.measureText(o),c=h.width+s*(l-1),f=h.actualBoundingBoxAscent,u=h.actualBoundingBoxDescent,d=(f+u)*this.lineHeight.get(t.zoom,i),p=new C.default(e[0][0].x,e[0][0].y);return[{anchor:p,bboxes:[{minX:p.x,minY:p.y-f,maxX:p.x+c,maxY:p.y+u+(a.length-1)*d}],draw:(e,r)=>{e.globalAlpha=1,e.font=n,e.fillStyle=this.fill.get(t.zoom,i);const o=this.width.get(t.zoom,i);let l=0;for(const n of a){let a=0;if(2===this.justify||r&&2===r.justify?a=(c-e.measureText(n).width)/2:(3===this.justify||r&&3===r.justify)&&(a=c-e.measureText(n).width),o)if(e.lineWidth=2*o,e.strokeStyle=this.stroke.get(t.zoom,i),s>0){let t=a;for(const i of n)e.strokeText(i,t,l),t+=e.measureText(i).width+s}else e.strokeText(n,a,l);if(s>0){let t=a;for(const i of n)e.fillText(i,t,l),t+=e.measureText(i).width+s}else e.fillText(n,a,l);l+=d}}}]}},ke=class{constructor(t){this.centered=new xe(new ve(t))}place(t,e,i){return this.centered.place(t,e,i)}},ze=class{constructor(t,e){var i,r,n;this.symbolizer=t,this.offsetX=new E(e.offsetX,0),this.offsetY=new E(e.offsetY,0),this.justify=null!=(i=e.justify)?i:void 0,this.placements=null!=(r=e.placements)?r:[2,6,8,4,1,3,5,7],this.ddValues=null!=(n=e.ddValues)?n:()=>({})}place(t,e,i){if(1!==i.geomType)return;const r=e[0][0],n=this.symbolizer.place(t,[[new C.default(0,0)]],i);if(!n||0===n.length)return;const s=n[0],a=s.bboxes[0];let o=this.offsetX,l=this.offsetY,h=this.justify,c=this.placements;const{offsetX:f,offsetY:u,justify:d,placements:p}=this.ddValues(t.zoom,i)||{};f&&(o=new E(f,0)),u&&(l=new E(u,0)),d&&(h=d),p&&(c=p);const m=o.get(t.zoom,i),g=l.get(t.zoom,i);let y,b=new C.default(m,g);const _=t=>{t.translate(b.x,b.y),s.draw(t,{justify:y})},x=(e,i)=>{const n=((t,e)=>({minX:t.x+e.x+a.minX,minY:t.y+e.y+a.minY,maxX:t.x+e.x+a.maxX,maxY:t.y+e.y+a.maxY}))(e,i);if(!t.index.bboxCollides(n,t.order))return[{anchor:r,bboxes:[n],draw:_}]};for(const t of c){const e=this.computeXaxisOffset(m,a,t),i=this.computeYaxisOffset(g,a,t);return y=this.computeJustify(h,t),b=new C.default(e,i),x(r,b)}}computeXaxisOffset(t,e,i){const r=e.maxX,n=r/2;return[1,5].includes(i)?t-n:[8,7,6].includes(i)?t-r:t}computeYaxisOffset(t,e,i){const r=Math.abs(e.minY),n=e.maxY,s=(e.minY+e.maxY)/2;return[3,7].includes(i)?t-s:[8,2,1].includes(i)?t-n:[6,4,5].includes(i)?t+r:t}computeJustify(t,e){return t||([1,5].includes(e)?2:[2,3,4].includes(e)?1:3)}},Me=class{constructor(t){this.symbolizer=new ze(new ve(t),t)}place(t,e,i){return this.symbolizer.place(t,e,i)}},Te=(t=>(t[t.Above=1]="Above",t[t.Center=2]="Center",t[t.Below=3]="Below",t))(Te||{}),Le=class{constructor(t){var e;this.font=new U(t),this.text=new A(t),this.fill=new V(t.fill,"black"),this.stroke=new V(t.stroke,"black"),this.width=new E(t.width,0),this.offset=new E(t.offset,0),this.position=null!=(e=t.position)?e:1,this.maxLabelCodeUnits=new E(t.maxLabelChars,40),this.repeatDistance=new E(t.repeatDistance,250)}place(t,e,i){const r=this.text.get(t.zoom,i);if(!r)return;if(r.length>this.maxLabelCodeUnits.get(t.zoom,i))return;const n=i.bbox;if(n.maxY-n.minY<20&&n.maxX-n.minX<20)return;const s=this.font.get(t.zoom,i);t.scratch.font=s;const a=t.scratch.measureText(r),o=a.width,l=a.actualBoundingBoxAscent+a.actualBoundingBoxDescent;let h=this.repeatDistance.get(t.zoom,i);t.overzoom>4&&(h*=1<<t.overzoom-4);const c=2*l,f=function(t,e,i,r){const n=[];for(const s of t){const t=$(s,Math.PI/45,e);for(const a of t)if(a.length>=e+r){const t=new R.default(s[a.beginIndex].x,s[a.beginIndex].y),o=s[a.endIndex-1],l=new R.default((o.x-t.x)/a.length,(o.y-t.y)/a.length);for(let s=r;s<a.length-e;s+=i)n.push({start:t.add(l.mult(s)),end:t.add(l.mult(s+e))})}}return n}(e,o,h,c);if(0===f.length)return;const u=[];for(const e of f){const n=e.end.x-e.start.x,a=e.end.y-e.start.y,f=I(e.start,e.end,o,c/2).map((t=>({minX:t.x-c/2,minY:t.y-c/2,maxX:t.x+c/2,maxY:t.y+c/2}))),d=e=>{e.globalAlpha=1,e.rotate(Math.atan2(a,n)),n<0&&(e.scale(-1,-1),e.translate(-o,0));let h=0;3===this.position?h+=l:2===this.position&&(h+=l/2),e.translate(0,h-this.offset.get(t.zoom,i)),e.font=s;const c=this.width.get(t.zoom,i);c&&(e.lineWidth=c,e.strokeStyle=this.stroke.get(t.zoom,i),e.strokeText(r,0,0)),e.fillStyle=this.fill.get(t.zoom,i),e.fillText(r,0,0)};u.push({anchor:e.start,bboxes:f,draw:d,deduplicationKey:r,deduplicationDistance:h})}return u}},je=(t,e)=>{const i=t[e];return"string"==typeof i?i:""},Se=(t,e)=>{const i=t[e];return"number"==typeof i?i:0},Xe=t=>[{dataLayer:"earth",symbolizer:new ne({fill:t.earth})},{dataLayer:"landuse",symbolizer:new ne({fill:(e,i)=>D(t.park_a,t.park_b,Math.min(Math.max(e/12,12),0))}),filter:(t,e)=>{const i=je(e.props,"pmap:kind");return["allotments","village_green","playground"].includes(i)}},{dataLayer:"landuse",symbolizer:new ne({fill:t.park_b,opacity:.7}),filter:(t,e)=>{const i=je(e.props,"pmap:kind");return["national_park","park","cemetery","protected_area","nature_reserve","forest","golf_course"].includes(i)}},{dataLayer:"landuse",symbolizer:new ne({fill:t.hospital}),filter:(t,e)=>"hospital"===e.props["pmap:kind"]},{dataLayer:"landuse",symbolizer:new ne({fill:t.industrial}),filter:(t,e)=>"industrial"===e.props["pmap:kind"]},{dataLayer:"landuse",symbolizer:new ne({fill:t.school}),filter:(t,e)=>{const i=je(e.props,"pmap:kind");return["school","university","college"].includes(i)}},{dataLayer:"landuse",symbolizer:new ne({fill:t.beach}),filter:(t,e)=>"beach"===e.props["pmap:kind"]},{dataLayer:"landuse",symbolizer:new ne({fill:t.zoo}),filter:(t,e)=>"zoo"===e.props["pmap:kind"]},{dataLayer:"landuse",symbolizer:new ne({fill:t.zoo}),filter:(t,e)=>{const i=je(e.props,"pmap:kind");return["military","naval_base","airfield"].includes(i)}},{dataLayer:"natural",symbolizer:new ne({fill:(e,i)=>D(t.wood_a,t.wood_b,Math.min(Math.max(e/12,12),0))}),filter:(t,e)=>{const i=je(e.props,"pmap:kind");return["wood","nature_reserve","forest"].includes(i)}},{dataLayer:"natural",symbolizer:new ne({fill:(e,i)=>D(t.scrub_a,t.scrub_b,Math.min(Math.max(e/12,12),0))}),filter:(t,e)=>{const i=je(e.props,"pmap:kind");return["scrub","grassland","grass"].includes(i)}},{dataLayer:"natural",symbolizer:new ne({fill:t.scrub_b}),filter:(t,e)=>{const i=je(e.props,"pmap:kind");return["scrub","grassland","grass"].includes(i)}},{dataLayer:"natural",symbolizer:new ne({fill:t.glacier}),filter:(t,e)=>"glacier"===e.props["pmap:kind"]},{dataLayer:"natural",symbolizer:new ne({fill:t.sand}),filter:(t,e)=>"sand"===e.props["pmap:kind"]},{dataLayer:"landuse",symbolizer:new ne({fill:t.aerodrome}),filter:(t,e)=>"aerodrome"===e.props["pmap:kind"]},{dataLayer:"water",symbolizer:new ne({fill:t.water})},{dataLayer:"transit",symbolizer:new de({color:t.runway,width:(t,e)=>he(1.6,[[11,0],[13,4],[19,30]])(t)}),filter:(t,e)=>"runway"===e.props["pmap:kind_detail"]},{dataLayer:"transit",symbolizer:new de({color:t.runway,width:(t,e)=>he(1.6,[[14,0],[14.5,1],[16,6]])(t)}),filter:(t,e)=>"taxiway"===e.props["pmap:kind_detail"]},{dataLayer:"transit",symbolizer:new de({color:t.pier,width:(t,e)=>he(1.6,[[13,0],[13.5,0,5],[21,16]])(t)}),filter:(t,e)=>"pier"===e.props["pmap:kind"]},{dataLayer:"physical_line",minzoom:14,symbolizer:new de({color:t.water,width:(t,e)=>he(1.6,[[9,0],[9.5,1],[18,12]])(t)}),filter:(t,e)=>"river"===e.props["pmap:kind"]},{dataLayer:"physical_line",minzoom:14,symbolizer:new de({color:t.water,width:.5}),filter:(t,e)=>"stream"===e.props["pmap:kind"]},{dataLayer:"landuse",symbolizer:new ne({fill:t.pedestrian}),filter:(t,e)=>"pedestrian"===e.props["pmap:kind"]},{dataLayer:"landuse",symbolizer:new ne({fill:t.pier}),filter:(t,e)=>"pier"===e.props["pmap:kind"]},{dataLayer:"buildings",symbolizer:new ne({fill:t.buildings,opacity:.5})},{dataLayer:"roads",symbolizer:new de({color:t.major,width:(t,e)=>he(1.6,[[14,0],[20,7]])(t)}),filter:(t,e)=>{const i=je(e.props,"pmap:kind");return["other","path"].includes(i)}},{dataLayer:"roads",symbolizer:new de({color:t.major,width:(t,e)=>he(1.6,[[13,0],[18,8]])(t)}),filter:(t,e)=>"minor_road"===e.props["pmap:kind"]},{dataLayer:"roads",symbolizer:new de({color:t.major,width:(t,e)=>he(1.6,[[7,0],[12,1.2],[15,3],[18,13]])(t)}),filter:(t,e)=>"medium_road"===e.props["pmap:kind"]},{dataLayer:"roads",symbolizer:new de({color:t.major,width:(t,e)=>he(1.6,[[6,0],[12,1.6],[15,3],[18,13]])(t)}),filter:(t,e)=>"major_road"===e.props["pmap:kind"]},{dataLayer:"roads",symbolizer:new de({color:t.major,width:(t,e)=>he(1.6,[[3,0],[6,1.1],[12,1.6],[15,5],[18,15]])(t)}),filter:(t,e)=>"highway"===e.props["pmap:kind"]},{dataLayer:"boundaries",symbolizer:new de({dash:[3,2],color:t.boundaries,width:1}),filter:(t,e)=>{const i=e.props["pmap:min_admin_level"];return"number"==typeof i&&i<=2}},{dataLayer:"transit",symbolizer:new de({dash:[.3,.75],color:t.railway,dashWidth:(t,e)=>he(1.6,[[4,0],[7,.15],[19,9]])(t),opacity:.5}),filter:(t,e)=>"rail"===e.props["pmap:kind"]},{dataLayer:"boundaries",symbolizer:new de({dash:[3,2],color:t.boundaries,width:.5}),filter:(t,e)=>{const i=e.props["pmap:min_admin_level"];return"number"==typeof i&&i>2}}],Ye=t=>{const e=["name"];return[{dataLayer:"roads",symbolizer:new Le({labelProps:e,fill:t.roads_label_minor,font:"400 12px sans-serif",width:2,stroke:t.roads_label_minor_halo}),minzoom:16,filter:(t,e)=>{const i=je(e.props,"pmap:kind");return["minor_road","other","path"].includes(i)}},{dataLayer:"roads",symbolizer:new Le({labelProps:e,fill:t.roads_label_major,font:"400 12px sans-serif",width:2,stroke:t.roads_label_major_halo}),minzoom:12,filter:(t,e)=>{const i=je(e.props,"pmap:kind");return["highway","major_road","medium_road"].includes(i)}},{dataLayer:"roads",symbolizer:new Le({labelProps:e,fill:t.roads_label_major,font:"400 12px sans-serif",width:2,stroke:t.roads_label_major_halo}),minzoom:12,filter:(t,e)=>{const i=je(e.props,"pmap:kind");return["highway","major_road","medium_road"].includes(i)}},{dataLayer:"physical_point",symbolizer:new ke({labelProps:e,fill:t.ocean_label,lineHeight:1.5,letterSpacing:1,font:(t,e)=>`400 ${fe([[3,10],[10,12]])(t)}px sans-serif`,textTransform:"uppercase"}),filter:(t,e)=>{const i=je(e.props,"pmap:kind");return["ocean","bay","strait","fjord"].includes(i)}},{dataLayer:"physical_point",symbolizer:new ke({labelProps:e,fill:t.ocean_label,lineHeight:1.5,letterSpacing:1,font:(t,e)=>`400 ${fe([[3,0],[6,12],[10,12]])(t)}px sans-serif`}),filter:(t,e)=>{const i=je(e.props,"pmap:kind");return["sea","lake","water"].includes(i)}},{dataLayer:"places",symbolizer:new ke({labelProps:(t,i)=>t<6?["name:short"]:e,fill:t.state_label,stroke:t.state_label_halo,width:1,lineHeight:1.5,font:(t,e)=>t<6?"400 16px sans-serif":"400 12px sans-serif",textTransform:"uppercase"}),filter:(t,e)=>"region"===e.props["pmap:kind"]},{dataLayer:"places",symbolizer:new ke({labelProps:e,fill:t.country_label,lineHeight:1.5,font:(t,e)=>"600 12px sans-serif",textTransform:"uppercase"}),filter:(t,e)=>"country"===e.props["pmap:kind"]},{dataLayer:"places",minzoom:9,symbolizer:new ke({labelProps:e,fill:t.city_label,lineHeight:1.5,font:(t,e)=>{if(!e)return"400 12px sans-serif";const i=e.props["pmap:min_zoom"];let r=400;i&&i<=5&&(r=600);let n=12;const s=e.props["pmap:population_rank"];return s&&s>9&&(n=16),`${r} ${n}px sans-serif`}}),sort:(t,e)=>Se(t,"pmap:population_rank")-Se(e,"pmap:population_rank"),filter:(t,e)=>"locality"===e.props["pmap:kind"]},{dataLayer:"places",maxzoom:8,symbolizer:new _e([new me({radius:2,fill:t.city_circle,stroke:t.city_circle_stroke,width:1.5}),new Me({labelProps:e,fill:t.city_label,stroke:t.city_label_halo,width:1,offsetX:6,offsetY:4.5,font:(t,e)=>"400 12px sans-serif"})]),filter:(t,e)=>"locality"===e.props["pmap:kind"]}]},Fe={light:{background:"#cccccc",earth:"#e0e0e0",park_a:"#cfddd5",park_b:"#9cd3b4",hospital:"#e4dad9",industrial:"#d1dde1",school:"#e4ded7",wood_a:"#d0ded0",wood_b:"#a0d9a0",pedestrian:"#e3e0d4",scrub_a:"#cedcd7",scrub_b:"#99d2bb",glacier:"#e7e7e7",sand:"#e2e0d7",beach:"#e8e4d0",aerodrome:"#dadbdf",runway:"#e9e9ed",water:"#80deea",pier:"#e0e0e0",zoo:"#c6dcdc",military:"#dcdcdc",tunnel_other_casing:"#e0e0e0",tunnel_minor_casing:"#e0e0e0",tunnel_link_casing:"#e0e0e0",tunnel_medium_casing:"#e0e0e0",tunnel_major_casing:"#e0e0e0",tunnel_highway_casing:"#e0e0e0",tunnel_other:"#d5d5d5",tunnel_minor:"#d5d5d5",tunnel_link:"#d5d5d5",tunnel_medium:"#d5d5d5",tunnel_major:"#d5d5d5",tunnel_highway:"#d5d5d5",transit_pier:"#e0e0e0",buildings:"#cccccc",minor_service_casing:"#e0e0e0",minor_casing:"#e0e0e0",link_casing:"#e0e0e0",medium_casing:"#e0e0e0",major_casing_late:"#e0e0e0",highway_casing_late:"#e0e0e0",other:"#ebebeb",minor_service:"#ebebeb",minor_a:"#ebebeb",minor_b:"#ffffff",link:"#ffffff",medium:"#f5f5f5",major_casing_early:"#e0e0e0",major:"#ffffff",highway_casing_early:"#e0e0e0",highway:"#ffffff",railway:"#a7b1b3",boundaries:"#adadad",waterway_label:"#ffffff",bridges_other_casing:"#e0e0e0",bridges_minor_casing:"#e0e0e0",bridges_link_casing:"#e0e0e0",bridges_medium_casing:"#e0e0e0",bridges_major_casing:"#e0e0e0",bridges_highway_casing:"#e0e0e0",bridges_other:"#ebebeb",bridges_minor:"#ffffff",bridges_link:"#ffffff",bridges_medium:"#f0eded",bridges_major:"#f5f5f5",bridges_highway:"#ffffff",roads_label_minor:"#91888b",roads_label_minor_halo:"#ffffff",roads_label_major:"#938a8d",roads_label_major_halo:"#ffffff",ocean_label:"#ffffff",peak_label:"#7e9aa0",subplace_label:"#8f8f8f",subplace_label_halo:"#e0e0e0",city_circle:"#ffffff",city_circle_stroke:"#a3a3a3",city_label:"#5c5c5c",city_label_halo:"#e0e0e0",state_label:"#b3b3b3",state_label_halo:"#e0e0e0",country_label:"#a3a3a3"},dark:{background:"#34373d",earth:"#1f1f1f",park_a:"#232325",park_b:"#232325",hospital:"#252424",industrial:"#222222",school:"#262323",wood_a:"#202121",wood_b:"#202121",pedestrian:"#1e1e1e",scrub_a:"#222323",scrub_b:"#222323",glacier:"#1c1c1c",sand:"#212123",beach:"#28282a",aerodrome:"#1e1e1e",runway:"#333333",water:"#34373d",pier:"#222222",zoo:"#222323",military:"#242323",tunnel_other_casing:"#141414",tunnel_minor_casing:"#141414",tunnel_link_casing:"#141414",tunnel_medium_casing:"#141414",tunnel_major_casing:"#141414",tunnel_highway_casing:"#141414",tunnel_other:"#292929",tunnel_minor:"#292929",tunnel_link:"#292929",tunnel_medium:"#292929",tunnel_major:"#292929",tunnel_highway:"#292929",transit_pier:"#333333",buildings:"#111111",minor_service_casing:"#1f1f1f",minor_casing:"#1f1f1f",link_casing:"#1f1f1f",medium_casing:"#1f1f1f",major_casing_late:"#1f1f1f",highway_casing_late:"#1f1f1f",other:"#333333",minor_service:"#333333",minor_a:"#3d3d3d",minor_b:"#333333",link:"#3d3d3d",medium:"#3d3d3d",major_casing_early:"#1f1f1f",major:"#3d3d3d",highway_casing_early:"#1f1f1f",highway:"#474747",railway:"#000000",boundaries:"#5b6374",waterway_label:"#717784",bridges_other_casing:"#2b2b2b",bridges_minor_casing:"#1f1f1f",bridges_link_casing:"#1f1f1f",bridges_medium_casing:"#1f1f1f",bridges_major_casing:"#1f1f1f",bridges_highway_casing:"#1f1f1f",bridges_other:"#333333",bridges_minor:"#333333",bridges_link:"#3d3d3d",bridges_medium:"#3d3d3d",bridges_major:"#3d3d3d",bridges_highway:"#474747",roads_label_minor:"#525252",roads_label_minor_halo:"#1f1f1f",roads_label_major:"#666666",roads_label_major_halo:"#1f1f1f",ocean_label:"#717784",peak_label:"#898080",subplace_label:"#525252",subplace_label_halo:"#1f1f1f",city_circle:"#000000",city_circle_stroke:"#7a7a7a",city_label:"#7a7a7a",city_label_halo:"#212121",state_label:"#3d3d3d",state_label_halo:"#1f1f1f",country_label:"#5c5c5c"},white:{background:"#ffffff",earth:"#ffffff",park_a:"#fcfcfc",park_b:"#fcfcfc",hospital:"#f8f8f8",industrial:"#fcfcfc",school:"#f8f8f8",wood_a:"#fafafa",wood_b:"#fafafa",pedestrian:"#fdfdfd",scrub_a:"#fafafa",scrub_b:"#fafafa",glacier:"#fcfcfc",sand:"#fafafa",beach:"#f6f6f6",aerodrome:"#fdfdfd",runway:"#efefef",water:"#dcdcdc",pier:"#f5f5f5",zoo:"#f7f7f7",military:"#fcfcfc",tunnel_other_casing:"#d6d6d6",tunnel_minor_casing:"#fcfcfc",tunnel_link_casing:"#fcfcfc",tunnel_medium_casing:"#fcfcfc",tunnel_major_casing:"#fcfcfc",tunnel_highway_casing:"#fcfcfc",tunnel_other:"#d6d6d6",tunnel_minor:"#d6d6d6",tunnel_link:"#d6d6d6",tunnel_medium:"#d6d6d6",tunnel_major:"#d6d6d6",tunnel_highway:"#d6d6d6",transit_pier:"#efefef",buildings:"#efefef",minor_service_casing:"#ffffff",minor_casing:"#ffffff",link_casing:"#ffffff",medium_casing:"#ffffff",major_casing_late:"#ffffff",highway_casing_late:"#ffffff",other:"#f5f5f5",minor_service:"#f5f5f5",minor_a:"#ebebeb",minor_b:"#f5f5f5",link:"#ebebeb",medium:"#ebebeb",major_casing_early:"#ffffff",major:"#ebebeb",highway_casing_early:"#ffffff",highway:"#ebebeb",railway:"#d6d6d6",boundaries:"#adadad",waterway_label:"#adadad",bridges_other_casing:"#ffffff",bridges_minor_casing:"#ffffff",bridges_link_casing:"#ffffff",bridges_medium_casing:"#ffffff",bridges_major_casing:"#ffffff",bridges_highway_casing:"#ffffff",bridges_other:"#f5f5f5",bridges_minor:"#f5f5f5",bridges_link:"#ebebeb",bridges_medium:"#ebebeb",bridges_major:"#ebebeb",bridges_highway:"#ebebeb",roads_label_minor:"#adadad",roads_label_minor_halo:"#ffffff",roads_label_major:"#999999",roads_label_major_halo:"#ffffff",ocean_label:"#adadad",peak_label:"#adadad",subplace_label:"#8f8f8f",subplace_label_halo:"#ffffff",city_circle:"#ffffff",city_circle_stroke:"#adadad",city_label:"#5c5c5c",city_label_halo:"#ffffff",state_label:"#b3b3b3",state_label_halo:"#ffffff",country_label:"#b8b8b8"},grayscale:{background:"#a3a3a3",earth:"#cccccc",park_a:"#c2c2c2",park_b:"#c2c2c2",hospital:"#d0d0d0",industrial:"#c6c6c6",school:"#d0d0d0",wood_a:"#c2c2c2",wood_b:"#c2c2c2",pedestrian:"#c4c4c4",scrub_a:"#c2c2c2",scrub_b:"#c2c2c2",glacier:"#d2d2d2",sand:"#d2d2d2",beach:"#d2d2d2",aerodrome:"#c9c9c9",runway:"#f5f5f5",water:"#a3a3a3",pier:"#b8b8b8",zoo:"#c7c7c7",military:"#bfbfbf",tunnel_other_casing:"#b8b8b8",tunnel_minor_casing:"#b8b8b8",tunnel_link_casing:"#b8b8b8",tunnel_medium_casing:"#b8b8b8",tunnel_major_casing:"#b8b8b8",tunnel_highway_casing:"#b8b8b8",tunnel_other:"#d6d6d6",tunnel_minor:"#d6d6d6",tunnel_link:"#d6d6d6",tunnel_medium:"#d6d6d6",tunnel_major:"#d6d6d6",tunnel_highway:"#d6d6d6",transit_pier:"#b8b8b8",buildings:"#e0e0e0",minor_service_casing:"#cccccc",minor_casing:"#cccccc",link_casing:"#cccccc",medium_casing:"#cccccc",major_casing_late:"#cccccc",highway_casing_late:"#cccccc",other:"#e0e0e0",minor_service:"#e0e0e0",minor_a:"#ebebeb",minor_b:"#e0e0e0",link:"#ebebeb",medium:"#ebebeb",major_casing_early:"#cccccc",major:"#ebebeb",highway_casing_early:"#cccccc",highway:"#ebebeb",railway:"#f5f5f5",boundaries:"#5c5c5c",waterway_label:"#7a7a7a",bridges_other_casing:"#cccccc",bridges_minor_casing:"#cccccc",bridges_link_casing:"#cccccc",bridges_medium_casing:"#cccccc",bridges_major_casing:"#cccccc",bridges_highway_casing:"#cccccc",bridges_other:"#e0e0e0",bridges_minor:"#e0e0e0",bridges_link:"#ebebeb",bridges_medium:"#ebebeb",bridges_major:"#ebebeb",bridges_highway:"#ebebeb",roads_label_minor:"#999999",roads_label_minor_halo:"#e0e0e0",roads_label_major:"#8f8f8f",roads_label_major_halo:"#ebebeb",ocean_label:"#7a7a7a",peak_label:"#5c5c5c",subplace_label:"#7a7a7a",subplace_label_halo:"#cccccc",city_circle:"#c2c2c2",city_circle_stroke:"#7a7a7a",city_label:"#474747",city_label_halo:"#cccccc",state_label:"#999999",state_label_halo:"#cccccc",country_label:"#858585"},black:{background:"#2b2b2b",earth:"#141414",park_a:"#181818",park_b:"#181818",hospital:"#1d1d1d",industrial:"#101010",school:"#111111",wood_a:"#1a1a1a",wood_b:"#1a1a1a",pedestrian:"#191919",scrub_a:"#1c1c1c",scrub_b:"#1c1c1c",glacier:"#191919",sand:"#161616",beach:"#1f1f1f",aerodrome:"#191919",runway:"#323232",water:"#333333",pier:"#0a0a0a",zoo:"#191919",military:"#121212",tunnel_other_casing:"#101010",tunnel_minor_casing:"#101010",tunnel_link_casing:"#101010",tunnel_medium_casing:"#101010",tunnel_major_casing:"#101010",tunnel_highway_casing:"#101010",tunnel_other:"#292929",tunnel_minor:"#292929",tunnel_link:"#292929",tunnel_medium:"#292929",tunnel_major:"#292929",tunnel_highway:"#292929",transit_pier:"#0a0a0a",buildings:"#0a0a0a",minor_service_casing:"#141414",minor_casing:"#141414",link_casing:"#141414",medium_casing:"#141414",major_casing_late:"#141414",highway_casing_late:"#141414",other:"#1f1f1f",minor_service:"#1f1f1f",minor_a:"#292929",minor_b:"#1f1f1f",link:"#1f1f1f",medium:"#292929",major_casing_early:"#141414",major:"#292929",highway_casing_early:"#141414",highway:"#292929",railway:"#292929",boundaries:"#707070",waterway_label:"#707070",bridges_other_casing:"#141414",bridges_minor_casing:"#141414",bridges_link_casing:"#141414",bridges_medium_casing:"#141414",bridges_major_casing:"#141414",bridges_highway_casing:"#141414",bridges_other:"#1f1f1f",bridges_minor:"#1f1f1f",bridges_link:"#292929",bridges_medium:"#292929",bridges_major:"#292929",bridges_highway:"#292929",roads_label_minor:"#525252",roads_label_minor_halo:"#141414",roads_label_major:"#5c5c5c",roads_label_major_halo:"#141414",ocean_label:"#707070",peak_label:"#707070",subplace_label:"#5c5c5c",subplace_label_halo:"#141414",city_circle:"#000000",city_circle_stroke:"#666666",city_label:"#999999",city_label_halo:"#141414",state_label:"#3d3d3d",state_label_halo:"#141414",country_label:"#707070"}},Be=l(c()),De=l(b()),Ce=l(c()),Pe=(t,e,i)=>{const r=[];for(const n of t){const t=[];for(const r of n)t.push(r.clone().mult(e).add(i));r.push(t)}return r},Ve=(t,e)=>{const i=1<<e;return t<0?i+t:t>=i?t%i:t},Ee=class{constructor(t,e,i){this.tileCache=t,this.maxDataLevel=e,this.levelDiff=i}dataTilesForBounds(t,e){const i=a(2,t)/a(2,Math.ceil(t)),r=[];let n=1;const s=this.tileCache.tileSize;if(t<this.levelDiff)n=1/(1<<this.levelDiff-t)*i,r.push({dataTile:{z:0,x:0,y:0},origin:new Ce.default(0,0),scale:n,dim:s*n});else if(t<=this.levelDiff+this.maxDataLevel){const n=1<<this.levelDiff,a=256*i,o=Math.ceil(t)-this.levelDiff,l=Math.floor(e.minX/n/a),h=Math.floor(e.minY/n/a),c=Math.floor(e.maxX/n/a),f=Math.floor(e.maxY/n/a);for(let t=l;t<=c;t++)for(let e=h;e<=f;e++){const l=new Ce.default(t*n*a,e*n*a);r.push({dataTile:{z:o,x:Ve(t,o),y:Ve(e,o)},origin:l,scale:i,dim:s*i})}}else{const a=1<<this.levelDiff;n=(1<<Math.ceil(t)-this.maxDataLevel-this.levelDiff)*i;const o=Math.floor(e.minX/a/256/n),l=Math.floor(e.minY/a/256/n),h=Math.floor(e.maxX/a/256/n),c=Math.floor(e.maxY/a/256/n);for(let t=o;t<=h;t++)for(let e=l;e<=c;e++){const i=new Ce.default(t*a*256*n,e*a*256*n);r.push({dataTile:{z:this.maxDataLevel,x:Ve(t,this.maxDataLevel),y:Ve(e,this.maxDataLevel)},origin:i,scale:n,dim:s*n})}}return r}dataTileForDisplayTile(t){let e,i,r=1,n=this.tileCache.tileSize;if(t.z<this.levelDiff)e={z:0,x:0,y:0},r=1/(1<<this.levelDiff-t.z),i=new Ce.default(0,0),n*=r;else if(t.z<=this.levelDiff+this.maxDataLevel){const r=1<<this.levelDiff;e={z:t.z-this.levelDiff,x:Math.floor(t.x/r),y:Math.floor(t.y/r)},i=new Ce.default(e.x*r*256,e.y*r*256)}else{r=1<<t.z-this.maxDataLevel-this.levelDiff;const s=1<<this.levelDiff;e={z:this.maxDataLevel,x:Math.floor(t.x/s/r),y:Math.floor(t.y/s/r)},i=new Ce.default(e.x*s*r*256,e.y*s*r*256),n*=r}return{dataTile:e,scale:r,origin:i,dim:n}}getBbox(t,e){return h(this,null,(function*(){const i=this.dataTilesForBounds(t,e);return(yield Promise.all(i.map((t=>this.tileCache.get(t.dataTile))))).map(((e,r)=>{const n=i[r];return{data:e,z:t,dataTile:n.dataTile,scale:n.scale,dim:n.dim,origin:n.origin}}))}))}getDisplayTile(t){return h(this,null,(function*(){const e=this.dataTileForDisplayTile(t);return{data:yield this.tileCache.get(e.dataTile),z:t.z,dataTile:e.dataTile,scale:e.scale,origin:e.origin,dim:e.dim}}))}},Ae=t=>{const e=t=>{const e=void 0===t.levelDiff?1:t.levelDiff,i=t.maxDataZoom||15;let r;if("string"==typeof t.url)r=t.url.endsWith(".pmtiles")?new Gt(t.url,!0):new Qt(t.url,!0);else{if(!t.url)throw new Error(`Invalid source ${t.url}`);r=new Gt(t.url,!0)}const n=new te(r,256<<e);return new Ee(n,i,e)},i=new Map;if(t.sources)for(const r in t.sources)i.set(r,e(t.sources[r]));else i.set("",e(t));return i},Ue=(t,e,i)=>{const r=256,n=e/r,s=Math.floor(i.minX/r),a=Math.floor(i.minY/r),o=Math.floor(i.maxX/r),l=Math.floor(i.maxY/r),h=Math.log2(n),c=[];for(let e=s;e<=o;e++){const i=e%(1<<t);for(let e=a;e<=l;e++)c.push({display:Kt({z:t,x:i,y:e}),key:Kt({z:t-h,x:Math.floor(i/n),y:Math.floor(e/n)})})}return c},Re=class{constructor(t,e){this.tree=new De.default,this.current=new Map,this.dim=t,this.maxLabeledTiles=e}hasPrefix(t){for(const e of this.current.keys())if(e.startsWith(t))return!0;return!1}has(t){return this.current.has(t)}size(){return this.current.size}keys(){return this.current.keys()}searchBbox(t,e){const i=new Set;for(const r of this.tree.search(t))r.indexedLabel.order<=e&&i.add(r.indexedLabel);return i}searchLabel(t,e){const i=new Set;for(const r of t.bboxes)for(const t of this.tree.search(r))t.indexedLabel.order<=e&&i.add(t.indexedLabel);return i}bboxCollides(t,e){for(const i of this.tree.search(t))if(i.indexedLabel.order<=e)return!0;return!1}labelCollides(t,e){for(const i of t.bboxes)for(const t of this.tree.search(i))if(t.indexedLabel.order<=e)return!0;return!1}deduplicationCollides(t){if(!t.deduplicationKey||!t.deduplicationDistance)return!1;const e=t.deduplicationDistance,i={minX:t.anchor.x-e,minY:t.anchor.y-e,maxX:t.anchor.x+e,maxY:t.anchor.y+e};for(const r of this.tree.search(i))if(r.indexedLabel.deduplicationKey===t.deduplicationKey&&r.indexedLabel.anchor.dist(t.anchor)<e)return!0;return!1}makeEntry(t){this.current.get(t)&&console.log("consistency error 1");const e=new Set;this.current.set(t,e)}insert(t,e,i){const r={anchor:t.anchor,bboxes:t.bboxes,draw:t.draw,order:e,tileKey:i,deduplicationKey:t.deduplicationKey,deduplicationDistance:t.deduplicationDistance};let n=this.current.get(i);if(!n){const t=new Set;this.current.set(i,t),n=t}n.add(r);let s=!1,a=!1;for(const e of t.bboxes)this.tree.insert({minX:e.minX,minY:e.minY,maxX:e.maxX,maxY:e.maxY,indexedLabel:r}),e.minX<0&&(s=!0),e.maxX>this.dim&&(a=!0);if(s||a){const r=s?this.dim:-this.dim,n=[];for(const e of t.bboxes)n.push({minX:e.minX+r,minY:e.minY,maxX:e.maxX+r,maxY:e.maxY});const a={anchor:new Be.default(t.anchor.x+r,t.anchor.y),bboxes:n,draw:t.draw,order:e,tileKey:i},o=this.current.get(i);o&&o.add(a);for(const t of n)this.tree.insert({minX:t.minX,minY:t.minY,maxX:t.maxX,maxY:t.maxY,indexedLabel:a})}}pruneOrNoop(t){const e=t.split(":");let i,r=0,n=0;for(const t of this.current.keys()){const s=t.split(":");if(s[3]===e[3]){n++;const o=Math.sqrt(a(+s[0]-+e[0],2)+a(+s[1]-+e[1],2));o>r&&(r=o,i=t)}i&&n>this.maxLabeledTiles&&this.pruneKey(i)}}pruneKey(t){const e=this.current.get(t);if(!e)return;const i=[];for(const t of this.tree.all())e.has(t.indexedLabel)&&i.push(t);for(const t of i)this.tree.remove(t);this.current.delete(t)}removeLabel(t){const e=[];for(const i of this.tree.all())t===i.indexedLabel&&e.push(i);for(const t of e)this.tree.remove(t);const i=this.current.get(t.tileKey);i&&i.delete(t)}},$e=class{constructor(t,e,i,r,n){this.index=new Re(256<<t,r),this.z=t,this.scratch=e,this.labelRules=i,this.callback=n}layout(t){const e=performance.now(),i=new Set;for(const[e,r]of t)for(const t of r){const r=`${Kt(t.dataTile)}:${e}`;this.index.has(r)||(this.index.makeEntry(r),i.add(r))}const r=new Set;for(const[e,n]of this.labelRules.entries()){if(!1===n.visible)continue;if(n.minzoom&&this.z<n.minzoom)continue;if(n.maxzoom&&this.z>n.maxzoom)continue;const s=n.dataSource||"",a=t.get(s);if(a)for(const t of a){const a=`${Kt(t.dataTile)}:${s}`;if(!i.has(a))continue;const o=t.data.get(n.dataLayer);if(void 0===o)continue;const l=o;n.sort&&l.sort(((t,e)=>n.sort?n.sort(t.props,e.props):0));const h={index:this.index,zoom:this.z,scratch:this.scratch,order:e,overzoom:this.z-t.dataTile.z};for(const i of l){if(n.filter&&!n.filter(this.z,i))continue;const s=Pe(i.geom,t.scale,t.origin),o=n.symbolizer.place(h,s,i);if(o)for(const i of o){let n=!1;if(!i.deduplicationKey||!this.index.deduplicationCollides(i)){if(this.index.labelCollides(i,1/0)){if(!this.index.labelCollides(i,e)){const s=this.index.searchLabel(i,1/0);for(const e of s){this.index.removeLabel(e);for(const i of e.bboxes)this.findInvalidatedTiles(r,t.dim,i,a)}this.index.insert(i,e,a),n=!0}}else this.index.insert(i,e,a),n=!0;if(n)for(const e of i.bboxes)(e.maxX>t.origin.x+t.dim||e.minX<t.origin.x||e.minY<t.origin.y||e.maxY>t.origin.y+t.dim)&&this.findInvalidatedTiles(r,t.dim,e,a)}}}}}for(const t of i)this.index.pruneOrNoop(t);return r.size>0&&this.callback&&this.callback(r),performance.now()-e}findInvalidatedTiles(t,e,i,r){const n=Ue(this.z,e,i);for(const e of n)e.key!==r&&this.index.hasPrefix(e.key)&&t.add(e.display)}add(t){let e=!0;for(const[i,r]of t)for(const t of r)this.index.has(`${Kt(t.dataTile)}:${i}`)||(e=!1);if(e)return 0;return this.layout(t)}},Ie=class{constructor(t,e,i,r){this.labelers=new Map,this.scratch=t,this.labelRules=e,this.maxLabeledTiles=i,this.callback=r}add(t,e){let i=this.labelers.get(t);return i||(i=new $e(t,this.scratch,this.labelRules,this.maxLabeledTiles,this.callback),this.labelers.set(t,i)),i.add(e)}getIndex(t){const e=this.labelers.get(t);if(e)return e.index}},Oe=l(c());function qe(t,e,i,r,n,s,a,o,l){const h=performance.now();t.save(),t.miterLimit=2;for(const r of n){if(r.minzoom&&e<r.minzoom)continue;if(r.maxzoom&&e>r.maxzoom)continue;const n=i.get(r.dataSource||"");if(n)for(const e of n){const i=e.data.get(r.dataLayer);if(void 0===i)continue;r.symbolizer.before&&r.symbolizer.before(t,e.z);const n=e.origin,l=e.dim,h=e.scale;if(t.save(),o){t.beginPath();const e=Math.max(n.x-a.x,s.minX-a.x),i=Math.max(n.y-a.y,s.minY-a.y),r=Math.min(n.x-a.x+l,s.maxX-a.x),o=Math.min(n.y-a.y+l,s.maxY-a.y);t.rect(e,i,r-e,o-i),t.clip()}t.translate(n.x-a.x,n.y-a.y);for(const a of i){let i=a.geom;const o=a.bbox;o.maxX*h+n.x<s.minX||o.minX*h+n.x>s.maxX||o.minY*h+n.y>s.maxY||o.maxY*h+n.y<s.minY||(r.filter&&!r.filter(e.z,a)||(1!==h&&(i=Pe(i,h,new Oe.default(0,0))),r.symbolizer.draw(t,i,e.z,a)))}t.restore()}}if(o&&(t.beginPath(),t.rect(s.minX-a.x,s.minY-a.y,s.maxX-s.minX,s.maxY-s.minY),t.clip()),r){const e=r.searchBbox(s,1/0);for(const i of e)if(t.save(),t.translate(i.anchor.x-a.x,i.anchor.y-a.y),i.draw(t),t.restore(),l){t.lineWidth=.5,t.strokeStyle=l,t.fillStyle=l,t.globalAlpha=1,t.fillRect(i.anchor.x-a.x-2,i.anchor.y-a.y-2,4,4);for(const e of i.bboxes)t.strokeRect(e.minX-a.x,e.minY-a.y,e.maxX-e.minX,e.maxY-e.minY)}}return t.restore(),performance.now()-h}var We=6378137,Ne=85.0511287798,Ze=We*Math.PI,Ke=t=>{const e=Math.PI/180,i=Math.max(Math.min(Ne,t.y),-Ne),r=Math.sin(i*e);return new _.default(We*t.x*e,We*Math.log((1+r)/(1-r))/2)},He=(t,e)=>i=>{const r=Ke(i);return new _.default((r.x+Ze)/(2*Ze),1-(r.y+Ze)/(2*Ze)).mult(256*(1<<e)).sub(t)},Je=(t,e)=>i=>{const r=new _.default(i.x,i.y).add(t).div(256*(1<<e));return(t=>{const e=180/Math.PI;return{lat:(2*Math.atan(Math.exp(t.y/We))-Math.PI/2)*e,lng:t.x*e/We}})(new _.default(r.x*(2*Ze)-Ze,(1-r.y)*(2*Ze)-Ze))},Ge=(t,e)=>{const i=e*(360/t);return Math.log2(i/256)},Qe=class{constructor(t){if(t.theme){const e=Fe[t.theme];this.paintRules=Xe(e),this.labelRules=Ye(e),this.backgroundColor=e.background}else this.paintRules=t.paintRules||[],this.labelRules=t.labelRules||[],this.backgroundColor=t.backgroundColor;this.views=Ae(t),this.debug=t.debug||""}drawContext(t,e,i,r,n){return h(this,null,(function*(){const s=Ke(r),o=new _.default((s.x+Ze)/(2*Ze),1-(s.y+Ze)/(2*Ze)).clone().mult(256*a(2,n)).sub(new _.default(e/2,i/2)),l={minX:o.x,minY:o.y,maxX:o.x+e,maxY:o.y+i},h=[];for(const[t,e]of this.views){const i=e.getBbox(n,l);h.push({key:t,promise:i})}const c=yield Promise.all(h.map((t=>t.promise.then((e=>({status:"fulfilled",value:e,key:t.key})),(e=>({status:"rejected",value:[],reason:e,key:t.key})))))),f=new Map;for(const t of c)"fulfilled"===t.status&&f.set(t.key,t.value);const u=performance.now(),d=new $e(n,t,this.labelRules,16,void 0);d.add(f),this.backgroundColor&&(t.save(),t.fillStyle=this.backgroundColor,t.fillRect(0,0,e,i),t.restore());const p=this.paintRules;if(qe(t,n,f,d.index,p,l,o,!0,this.debug),this.debug){t.save(),t.translate(-o.x,-o.y),t.strokeStyle=this.debug,t.fillStyle=this.debug,t.font="12px sans-serif";let e=0;for(const[i,r]of f){for(const n of r){t.strokeRect(n.origin.x,n.origin.y,n.dim,n.dim);const r=n.dataTile;t.fillText(`${i+(i?" ":"")+r.z} ${r.x} ${r.y}`,n.origin.x+4,n.origin.y+14*(1+e))}e++}t.restore()}return{elapsed:performance.now()-u,project:He(o,n),unproject:Je(o,n)}}))}drawCanvas(t,e,i){return h(this,arguments,(function*(t,e,i,r={}){const n=window.devicePixelRatio,s=t.clientWidth,a=t.clientHeight;t.width===s*n&&t.height===a*n||(t.width=s*n,t.height=a*n),r.lang&&(t.lang=r.lang);const o=t.getContext("2d");if(o)return o.setTransform(n,0,0,n,0,0),this.drawContext(o,s,a,e,i);console.error("Failed to initialize canvas2d context.")}))}drawContextBounds(t,e,i,r,n){return h(this,null,(function*(){const s=i.x-e.x,a=new _.default((e.x+i.x)/2,(e.y+i.y)/2);return this.drawContext(t,r,n,a,Ge(s,r))}))}drawCanvasBounds(t,e,i,r){return h(this,arguments,(function*(t,e,i,r,n={}){const s=i.x-e.x,a=new _.default((e.x+i.x)/2,(e.y+i.y)/2);return this.drawCanvas(t,a,Ge(s,r),n)}))}},ti=l(c()),ei=t=>t.then((t=>({status:"fulfilled",value:t})),(t=>({status:"rejected",reason:t}))),ii=(t={})=>{class e extends L.GridLayer{constructor(t={}){if(t.noWrap&&!t.bounds&&(t.bounds=[[-90,-180],[90,180]]),null==t.attribution&&(t.attribution='<a href="https://protomaps.com">Protomaps</a> © <a href="https://openstreetmap.org/copyright">OpenStreetMap</a>'),super(t),t.theme){const e=Fe[t.theme];this.paintRules=Xe(e),this.labelRules=Ye(e),this.backgroundColor=e.background}else this.paintRules=t.paintRules||[],this.labelRules=t.labelRules||[],this.backgroundColor=t.backgroundColor;this.lastRequestedZ=void 0,this.tasks=t.tasks||[],this.views=Ae(t),this.debug=t.debug;const e=document.createElement("canvas").getContext("2d");this.scratch=e,this.onTilesInvalidated=t=>{for(const e of t)this.rerenderTile(e)},this.labelers=new Ie(this.scratch,this.labelRules,16,this.onTilesInvalidated),this.tileSize=256*window.devicePixelRatio,this.tileDelay=t.tileDelay||3,this.lang=t.lang}renderTile(t,e,i,r=(()=>{})){return h(this,null,(function*(){this.lastRequestedZ=t.z;const n=[];for(const[e,i]of this.views){const r=i.getDisplayTile(t);n.push({key:e,promise:r})}const s=yield Promise.all(n.map((t=>t.promise.then((e=>({status:"fulfilled",value:e,key:t.key})),(e=>({status:"rejected",reason:e,key:t.key})))))),a=new Map;for(const t of s)"fulfilled"===t.status?a.set(t.key,[t.value]):"AbortError"===t.reason.name||console.error(t.reason);if(e.key!==i)return;if(this.lastRequestedZ!==t.z)return;if(yield Promise.all(this.tasks.map(ei)),e.key!==i)return;if(this.lastRequestedZ!==t.z)return;const o=this.labelers.add(t.z,a);if(e.key!==i)return;if(this.lastRequestedZ!==t.z)return;const l=this.labelers.getIndex(t.z);if(!this._map)return;const h=this._map.getCenter().wrap(),c=this._getTiledPixelBounds(h),f=this._pxBoundsToTileRange(c).getCenter(),u=t.distanceTo(f)*this.tileDelay;var d;if(yield(d=u,new Promise((t=>{setTimeout((()=>{t()}),d)}))),e.key!==i)return;if(this.lastRequestedZ!==t.z)return;const p={minX:256*t.x-16,minY:256*t.y-16,maxX:256*(t.x+1)+16,maxY:256*(t.y+1)+16},m=new ti.default(256*t.x,256*t.y);e.width=this.tileSize,e.height=this.tileSize;const g=e.getContext("2d");if(!g)return void console.error("Failed to get Canvas context");g.setTransform(this.tileSize/256,0,0,this.tileSize/256,0,0),g.clearRect(0,0,256,256),this.backgroundColor&&(g.save(),g.fillStyle=this.backgroundColor,g.fillRect(0,0,256,256),g.restore());let y=0;const b=this.paintRules;if(y=qe(g,t.z,a,this.xray?null:l,b,p,m,!1,this.debug),this.debug){g.save(),g.fillStyle=this.debug,g.font="600 12px sans-serif",g.fillText(`${t.z} ${t.x} ${t.y}`,4,14),g.font="12px sans-serif";let e=28;for(const[t,i]of a){const r=i[0].dataTile;g.fillText(`${t+(t?" ":"")+r.z} ${r.x} ${r.y}`,4,e),e+=14}g.font="600 10px sans-serif",y>8&&(g.fillText(`${y.toFixed()} ms paint`,4,e),e+=14),o>8&&g.fillText(`${o.toFixed()} ms layout`,4,e),g.strokeStyle=this.debug,g.lineWidth=.5,g.beginPath(),g.moveTo(0,0),g.lineTo(0,256),g.stroke(),g.lineWidth=.5,g.beginPath(),g.moveTo(0,0),g.lineTo(256,0),g.stroke(),g.restore()}r()}))}rerenderTile(t){for(const e in this._tiles){const i=this._wrapCoords(this._keyToTileCoords(e));t===this._tileCoordsToKey(i)&&this.renderTile(i,this._tiles[e].el,t)}}clearLayout(){this.labelers=new Ie(this.scratch,this.labelRules,16,this.onTilesInvalidated)}rerenderTiles(){for(const t in this._tiles){const e=this._wrapCoords(this._keyToTileCoords(t)),i=this._tileCoordsToKey(e);this.renderTile(e,this._tiles[t].el,i)}}createTile(t,e){const i=L.DomUtil.create("canvas","leaflet-tile");i.lang=this.lang;const r=this._tileCoordsToKey(t);return i.key=r,this.renderTile(t,i,r,(()=>{e(void 0,i)})),i}_removeTile(t){const e=this._tiles[t];e&&(e.el.removed=!0,e.el.key=void 0,L.DomUtil.removeClass(e.el,"leaflet-tile-loaded"),e.el.width=e.el.height=0,L.DomUtil.remove(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))}}return new e(t)};var ri=(t,e,i)=>{const r=new FontFace(t,`url(${e})`,{weight:i});return document.fonts.add(r),r.load()},ni=t=>h(void 0,null,(function*(){return new Promise(((e,i)=>{const r=new Image;r.onload=()=>e(r),r.onerror=()=>i("Invalid SVG"),r.src=t}))})),si=class{constructor(t){this.src=t,this.canvas=document.createElement("canvas"),this.mapping=new Map,this.missingBox={x:0,y:0,w:0,h:0}}load(){return h(this,null,(function*(){let t=this.src;const e=window.devicePixelRatio;if(t.endsWith(".html")){const e=yield fetch(t);t=yield e.text()}const i=(new window.DOMParser).parseFromString(t,"text/html"),r=Array.from(i.body.children),n=yield ni(`data:image/svg+xml;base64,${btoa('\n<svg width="20px" height="20px" viewBox="0 0 50 50" version="1.1" xmlns="http://www.w3.org/2000/svg">\n    <rect width="50" height="50" fill="#cccccc"/>\n    <g transform="translate(5,5)">\n        <path fill="none" stroke="#666666" stroke-width="7" d="m11,12a8.5,8 0 1,1 17,0q0,4-4,6t-4.5,4.5-.4,4v.2m0,3v7"/>\n    </g>\n</svg>\n')}`),s=[{w:n.width*e,h:n.height*e,img:n,id:""}],a=new XMLSerializer;for(const t of r){const i=`data:image/svg+xml;base64,${btoa(a.serializeToString(t))}`,r=yield ni(i);s.push({w:r.width*e,h:r.height*e,img:r,id:t.id})}const o=function(t){let e=0,i=0;for(const r of t)e+=r.w*r.h,i=Math.max(i,r.w);t.sort(((t,e)=>e.h-t.h));const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let n=0,s=0;for(const e of t)for(let t=r.length-1;t>=0;t--){const i=r[t];if(!(e.w>i.w||e.h>i.h)){if(e.x=i.x,e.y=i.y,s=Math.max(s,e.y+e.h),n=Math.max(n,e.x+e.w),e.w===i.w&&e.h===i.h){const e=r.pop();t<r.length&&(r[t]=e)}else e.h===i.h?(i.x+=e.w,i.w-=e.w):e.w===i.w?(i.y+=e.h,i.h-=e.h):(r.push({x:i.x+e.w,y:i.y,w:i.w-e.w,h:e.h}),i.y+=e.h,i.h-=e.h);break}}return{w:n,h:s,fill:e/(n*s)||0}}(s);this.canvas.width=o.w,this.canvas.height=o.h;const l=this.canvas.getContext("2d");if(l)for(const t of s)void 0!==t.x&&void 0!==t.y&&(l.drawImage(t.img,t.x,t.y,t.w,t.h),t.id?this.mapping.set(t.id,{x:t.x,y:t.y,w:t.w,h:t.h}):this.missingBox={x:t.x,y:t.y,w:t.w,h:t.h});return this}))}get(t){let e=this.mapping.get(t);return e||(e=this.missingBox),e}};
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
export{xe as CenteredSymbolizer,ke as CenteredTextSymbolizer,me as CircleSymbolizer,ye as FlexSymbolizer,ri as Font,Zt as GeomType,_e as GroupSymbolizer,pe as IconSymbolizer,Re as Index,ee as Justify,$e as Labeler,Ie as Labelers,Te as LineLabelPlacement,Le as LineLabelSymbolizer,de as LineSymbolizer,ze as OffsetSymbolizer,Me as OffsetTextSymbolizer,Nt as PMTiles,we as Padding,Gt as PmtilesSource,ne as PolygonSymbolizer,si as Sheet,ge as ShieldSymbolizer,Qe as Static,ie as TextPlacements,ve as TextSymbolizer,te as TileCache,Ee as View,Qt as ZxySource,se as arr,Ue as covering,re as createPattern,ue as cubicBezier,he as exp,Ge as getZoom,Ye as labelRules,ii as leafletLayer,fe as linear,qe as paint,Xe as paintRules,Ae as sourcesToViews,ce as step,Kt as toIndex,Pe as transformGeom,Ve as wrap};export default null;
